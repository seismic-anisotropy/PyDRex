<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.1.0"/>
    <title>pydrex.diagnostics</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */@media (prefers-color-scheme:light){  pre{line-height:125%;}  span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}  .pdoc-code .hll{background-color:#ffffcc}  .pdoc-code{background:#f8f8f8;}  .pdoc-code .c{color:#3D7B7B; font-style:italic}  .pdoc-code .err{border:1px solid #FF0000}  .pdoc-code .k{color:#008000; font-weight:bold}  .pdoc-code .o{color:#666666}  .pdoc-code .ch{color:#3D7B7B; font-style:italic}  .pdoc-code .cm{color:#3D7B7B; font-style:italic}  .pdoc-code .cp{color:#9C6500}  .pdoc-code .cpf{color:#3D7B7B; font-style:italic}  .pdoc-code .c1{color:#3D7B7B; font-style:italic}  .pdoc-code .cs{color:#3D7B7B; font-style:italic}  .pdoc-code .gd{color:#A00000}  .pdoc-code .ge{font-style:italic}  .pdoc-code .gr{color:#E40000}  .pdoc-code .gh{color:#000080; font-weight:bold}  .pdoc-code .gi{color:#008400}  .pdoc-code .go{color:#717171}  .pdoc-code .gp{color:#000080; font-weight:bold}  .pdoc-code .gs{font-weight:bold}  .pdoc-code .gu{color:#800080; font-weight:bold}  .pdoc-code .gt{color:#0044DD}  .pdoc-code .kc{color:#008000; font-weight:bold}  .pdoc-code .kd{color:#008000; font-weight:bold}  .pdoc-code .kn{color:#008000; font-weight:bold}  .pdoc-code .kp{color:#008000}  .pdoc-code .kr{color:#008000; font-weight:bold}  .pdoc-code .kt{color:#B00040}  .pdoc-code .m{color:#666666}  .pdoc-code .s{color:#BA2121}  .pdoc-code .na{color:#687822}  .pdoc-code .nb{color:#008000}  .pdoc-code .nc{color:#0000FF; font-weight:bold}  .pdoc-code .no{color:#880000}  .pdoc-code .nd{color:#AA22FF}  .pdoc-code .ni{color:#717171; font-weight:bold}  .pdoc-code .ne{color:#CB3F38; font-weight:bold}  .pdoc-code .nf{color:#0000FF}  .pdoc-code .nl{color:#767600}  .pdoc-code .nn{color:#0000FF; font-weight:bold}  .pdoc-code .nt{color:#008000; font-weight:bold}  .pdoc-code .nv{color:#19177C}  .pdoc-code .ow{color:#AA22FF; font-weight:bold}  .pdoc-code .w{color:#bbbbbb}  .pdoc-code .mb{color:#666666}  .pdoc-code .mf{color:#666666}  .pdoc-code .mh{color:#666666}  .pdoc-code .mi{color:#666666}  .pdoc-code .mo{color:#666666}  .pdoc-code .sa{color:#BA2121}  .pdoc-code .sb{color:#BA2121}  .pdoc-code .sc{color:#BA2121}  .pdoc-code .dl{color:#BA2121}  .pdoc-code .sd{color:#BA2121; font-style:italic}  .pdoc-code .s2{color:#BA2121}  .pdoc-code .se{color:#AA5D1F; font-weight:bold}  .pdoc-code .sh{color:#BA2121}  .pdoc-code .si{color:#A45A77; font-weight:bold}  .pdoc-code .sx{color:#008000}  .pdoc-code .sr{color:#A45A77}  .pdoc-code .s1{color:#BA2121}  .pdoc-code .ss{color:#19177C}  .pdoc-code .bp{color:#008000}  .pdoc-code .fm{color:#0000FF}  .pdoc-code .vc{color:#19177C}  .pdoc-code .vg{color:#19177C}  .pdoc-code .vi{color:#19177C}  .pdoc-code .vm{color:#19177C}  .pdoc-code .il{color:#666666}}@media (prefers-color-scheme:dark){  pre{line-height:125%;}  span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}  .pdoc-code .hll{background-color:#49483e}  .pdoc-code{background:#272822; color:#f8f8f2}  .pdoc-code .c{color:#75715e}  .pdoc-code .err{color:#960050; background-color:#1e0010}  .pdoc-code .esc{color:#f8f8f2}  .pdoc-code .g{color:#f8f8f2}  .pdoc-code .k{color:#66d9ef}  .pdoc-code .l{color:#ae81ff}  .pdoc-code .n{color:#f8f8f2}  .pdoc-code .o{color:#f92672}  .pdoc-code .x{color:#f8f8f2}  .pdoc-code .p{color:#f8f8f2}  .pdoc-code .ch{color:#75715e}  .pdoc-code .cm{color:#75715e}  .pdoc-code .cp{color:#75715e}  .pdoc-code .cpf{color:#75715e}  .pdoc-code .c1{color:#75715e}  .pdoc-code .cs{color:#75715e}  .pdoc-code .gd{color:#f92672}  .pdoc-code .ge{color:#f8f8f2; font-style:italic}  .pdoc-code .gr{color:#f8f8f2}  .pdoc-code .gh{color:#f8f8f2}  .pdoc-code .gi{color:#a6e22e}  .pdoc-code .go{color:#66d9ef}  .pdoc-code .gp{color:#f92672; font-weight:bold}  .pdoc-code .gs{color:#f8f8f2; font-weight:bold}  .pdoc-code .gu{color:#75715e}  .pdoc-code .gt{color:#f8f8f2}  .pdoc-code .kc{color:#66d9ef}  .pdoc-code .kd{color:#66d9ef}  .pdoc-code .kn{color:#f92672}  .pdoc-code .kp{color:#66d9ef}  .pdoc-code .kr{color:#66d9ef}  .pdoc-code .kt{color:#66d9ef}  .pdoc-code .ld{color:#e6db74}  .pdoc-code .m{color:#ae81ff}  .pdoc-code .s{color:#e6db74}  .pdoc-code .na{color:#a6e22e}  .pdoc-code .nb{color:#f8f8f2}  .pdoc-code .nc{color:#a6e22e}  .pdoc-code .no{color:#66d9ef}  .pdoc-code .nd{color:#a6e22e}  .pdoc-code .ni{color:#f8f8f2}  .pdoc-code .ne{color:#a6e22e}  .pdoc-code .nf{color:#a6e22e}  .pdoc-code .nl{color:#f8f8f2}  .pdoc-code .nn{color:#f8f8f2}  .pdoc-code .nx{color:#a6e22e}  .pdoc-code .py{color:#f8f8f2}  .pdoc-code .nt{color:#f92672}  .pdoc-code .nv{color:#f8f8f2}  .pdoc-code .ow{color:#f92672}  .pdoc-code .w{color:#f8f8f2}  .pdoc-code .mb{color:#ae81ff}  .pdoc-code .mf{color:#ae81ff}  .pdoc-code .mh{color:#ae81ff}  .pdoc-code .mi{color:#ae81ff}  .pdoc-code .mo{color:#ae81ff}  .pdoc-code .sa{color:#e6db74}  .pdoc-code .sb{color:#e6db74}  .pdoc-code .sc{color:#e6db74}  .pdoc-code .dl{color:#e6db74}  .pdoc-code .sd{color:#e6db74}  .pdoc-code .s2{color:#e6db74}  .pdoc-code .se{color:#ae81ff}  .pdoc-code .sh{color:#e6db74}  .pdoc-code .si{color:#e6db74}  .pdoc-code .sx{color:#e6db74}  .pdoc-code .sr{color:#e6db74}  .pdoc-code .s1{color:#e6db74}  .pdoc-code .ss{color:#e6db74}  .pdoc-code .bp{color:#f8f8f2}  .pdoc-code .fm{color:#a6e22e}  .pdoc-code .vc{color:#f8f8f2}  .pdoc-code .vg{color:#f8f8f2}  .pdoc-code .vi{color:#f8f8f2}  .pdoc-code .vm{color:#f8f8f2}}</style>
    <style>/*! theme.css */@media (prefers-color-scheme:light){  :root{  --pdoc-background:#fff; }  .pdoc{  --text:#212529;  --muted:#6c757d;  --link:#3660a5;  --link-hover:#1659c5;  --code:#f8f8f8;  --active:#fff598;  --accent:#eee;  --accent2:#c1c1c1;  --nav-hover:rgba(255, 255, 255, 0.5);  --name:#0066BB;  --def:#008800;  --annotation:#007020; }}@media (prefers-color-scheme:dark){  :root{  --pdoc-background:#212529; }  .pdoc{  --text:#f7f7f7;  --muted:#9d9d9d;  --link:#58a6ff;  --link-hover:#3989ff;  --code:#333;  --active:#555;  --accent:#343434;  --accent2:#555;  --nav-hover:rgba(0, 0, 0, 0.1);  --name:#77C1FF;  --def:#0cdd0c;  --annotation:#00c037; }}.homediv{padding-top:56px; max-width:1080px;}.button{background-color:var(--muted);color:var(--pdoc-background);border:none;padding:16px 32px;text-align:center;text-decoration:none;display:inline-block;font-weight:bold;font-size:20px;margin:4px 2px;transition-duration:0.4s;cursor:pointer;width:48%;}.button:hover{background-color:var(--text);color:var(--active);}.katex-display{overflow:auto hidden}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css" integrity="sha384-vKruj+a13U8yHIkAyGgK1J3ArTLzrFGBbBc0tDp4ad/EyewESeXE/Iv67Aj8gKZ0" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js" integrity="sha384-PwRUT/YqbnEjkZO0zZxNqcxACrXe+j766U2amXcgMg5457rve2Y7I6ZJSm2A0mS4" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '\\[', right: '\\]', display: true},
                {left: '$', right: '$', display: false},
                {left: '\\(', right: '\\)', display: false},
                {left: '\\begin{equation}', right: '\\end{equation}', display: true},
                {left: '\\begin{equation\*}', right: '\\end{equation\*}', display: true},
                {left: '\\begin{align}', right: '\\end{align}', display: true},
                {left: '\\begin{align\*}', right: '\\end{align\*}', display: true},
            ],
            throwOnError: false
        });
    });
</script>
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/copy-tex.min.js" integrity="sha384-ww/583aHhxWkz5DEVn6OKtNiIaLi2iBRNZXfJRiY1Ai7tnJ9UXpEsyvOITVpTl4A" crossorigin="anonymous"></script></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../pydrex.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;pydrex</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="function" href="#elasticity_components">elasticity_components</a>
            </li>
            <li>
                    <a class="function" href="#bingham_average">bingham_average</a>
            </li>
            <li>
                    <a class="function" href="#finite_strain">finite_strain</a>
            </li>
            <li>
                    <a class="function" href="#symmetry">symmetry</a>
            </li>
            <li>
                    <a class="function" href="#misorientation_indices">misorientation_indices</a>
            </li>
            <li>
                    <a class="function" href="#misorientation_index">misorientation_index</a>
            </li>
            <li>
                    <a class="function" href="#coaxial_index">coaxial_index</a>
            </li>
            <li>
                    <a class="function" href="#smallest_angle">smallest_angle</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../pydrex.html">pydrex</a><wbr>.diagnostics    </h1>

                        <div class="docstring"><blockquote>
  <p>PyDRex: Methods to calculate texture and strain diagnostics.</p>
</blockquote>

<div class="pdoc-alert pdoc-alert-note">

<p>Calculations expect orientation matrices $a$ to represent passive
(i.e. alias) rotations, which are defined in terms of the extrinsic ZXZ
euler angles $ϕ, θ, φ$ as
$$
a = \begin{bmatrix}
        \cosφ\cosϕ - \cosθ\sinϕ\sinφ &amp; \cosθ\cosϕ\sinφ + \cosφ\sinϕ &amp; \sinφ\sinθ \cr
       -\sinφ\cosϕ - \cosθ\sinϕ\cosφ &amp; \cosθ\cosϕ\cosφ - \sinφ\sinϕ &amp; \cosφ\sinθ \cr
        \sinθ\sinϕ &amp; -\sinθ\cosϕ &amp; \cosθ
    \end{bmatrix}
$$
such that a[i, j] gives the direction cosine of the angle between the i-th
grain axis and the j-th external axis (in the global Eulerian frame).</p>

</div>
</div>

                        <input id="mod-diagnostics-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-diagnostics-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="sa">r</span><span class="sd">&quot;&quot;&quot;&gt; PyDRex: Methods to calculate texture and strain diagnostics.</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="sd">.. note::</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="sd">    Calculations expect orientation matrices $a$ to represent passive</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="sd">    (i.e. alias) rotations, which are defined in terms of the extrinsic ZXZ</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="sd">    euler angles $ϕ, θ, φ$ as</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="sd">    $$</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="sd">    a = \begin{bmatrix}</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="sd">            \cosφ\cosϕ - \cosθ\sinϕ\sinφ &amp; \cosθ\cosϕ\sinφ + \cosφ\sinϕ &amp; \sinφ\sinθ \cr</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="sd">           -\sinφ\cosϕ - \cosθ\sinϕ\cosφ &amp; \cosθ\cosϕ\cosφ - \sinφ\sinϕ &amp; \cosφ\sinθ \cr</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="sd">            \sinθ\sinϕ &amp; -\sinθ\cosϕ &amp; \cosθ</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="sd">        \end{bmatrix}</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="sd">    $$</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="sd">    such that a[i, j] gives the direction cosine of the angle between the i-th</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="sd">    grain axis and the j-th external axis (in the global Eulerian frame).</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="kn">import</span> <span class="nn">os</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="kn">import</span> <span class="nn">functools</span> <span class="k">as</span> <span class="nn">ft</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Pool</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="kn">import</span> <span class="nn">scipy.linalg</span> <span class="k">as</span> <span class="nn">la</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="kn">from</span> <span class="nn">pydrex</span> <span class="kn">import</span> <span class="n">stats</span> <span class="k">as</span> <span class="n">_stats</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="kn">from</span> <span class="nn">pydrex</span> <span class="kn">import</span> <span class="n">tensors</span> <span class="k">as</span> <span class="n">_tensors</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="kn">from</span> <span class="nn">pydrex</span> <span class="kn">import</span> <span class="n">geometry</span> <span class="k">as</span> <span class="n">_geo</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="kn">from</span> <span class="nn">pydrex</span> <span class="kn">import</span> <span class="n">logger</span> <span class="k">as</span> <span class="n">_log</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="k">def</span> <span class="nf">elasticity_components</span><span class="p">(</span><span class="n">voigt_matrices</span><span class="p">):</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate elasticity decompositions for the given elasticity tensors.</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="sd">    Args:</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="sd">    - `voigt_matrices` (array) — the Nx6x6 Voigt matrix representations of the averaged</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a><span class="sd">      elasticity tensors for a series of polycrystal textures</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="sd">    Returns a dictionary with the following data series:</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="sd">    - `&#39;bulk_modulus&#39;` — the computed bulk modulus for each Voigt matrix C</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a><span class="sd">    - `&#39;shear_modulus&#39;` — the computed shear modulus for each Voigt matrix C</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="sd">    - `&#39;percent_anisotropy&#39;` — for each Voigt matrix C, the total percentage of the</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a><span class="sd">      norm of the elastic tensor ||C|| that deviates from the norm of the &quot;closest&quot;</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a><span class="sd">      isotropic elasticity tensor</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a><span class="sd">    - `&#39;percent_hexagonal&#39;` — for each C, the percentage of ||C|| attributed to</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a><span class="sd">      hexagonally symmetric minerals</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a><span class="sd">    - `&#39;percent_tetragonal&#39;` — for each C, the percentage of ||C|| attributed to</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a><span class="sd">      tetragonally symmetric minerals</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a><span class="sd">    - `&#39;percent_orthorhombic&#39;` — for each C, the percentage of ||C|| attributed to</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a><span class="sd">      orthorhombically symmetric minerals</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a><span class="sd">    - `&#39;percent_monoclinic&#39;` — for each C, the percentage of ||C|| attributed to</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a><span class="sd">      monoclinically symmetric minerals</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a><span class="sd">    - `&#39;percent_triclinic&#39;` — for each C, the percentage of ||C|| attributed to</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a><span class="sd">      triclinically &quot;symmetric&quot; minerals (no mirror planes)</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a><span class="sd">    - `&#39;hexagonal_axis&#39;` — for each C, the axis of hexagonal symmetry for the &quot;closest&quot;</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a><span class="sd">      hexagonally symmetric approximation to C, a.k.a. the &quot;transverse isotropy&quot; axis</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a><span class="sd">    .. note::</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a><span class="sd">        Only 5 symmetry classes are relevant for elasticity decomposition,</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a><span class="sd">        compared to the usual 6 used to describe crystal families.</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a><span class="sd">        Crystals with cubic symmetry contribute to the isotropic elasticity tensor,</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a><span class="sd">        because the lattice spacing is identical in all orthogonal directions.</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a><span class="sd">        Note also that the trigonal crystal *system* is not a crystal family</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a><span class="sd">        (it belongs to the hexagonal family).</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>    <span class="n">n_matrices</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">voigt_matrices</span><span class="p">)</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>    <span class="n">out</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>        <span class="s2">&quot;bulk_modulus&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">n_matrices</span><span class="p">),</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>        <span class="s2">&quot;shear_modulus&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">n_matrices</span><span class="p">),</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>        <span class="s2">&quot;percent_anisotropy&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">n_matrices</span><span class="p">),</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>        <span class="s2">&quot;percent_hexagonal&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">n_matrices</span><span class="p">),</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>        <span class="s2">&quot;percent_tetragonal&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">n_matrices</span><span class="p">),</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>        <span class="s2">&quot;percent_orthorhombic&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">n_matrices</span><span class="p">),</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>        <span class="s2">&quot;percent_monoclinic&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">n_matrices</span><span class="p">),</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>        <span class="s2">&quot;percent_triclinic&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">n_matrices</span><span class="p">),</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a>        <span class="s2">&quot;hexagonal_axis&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">n_matrices</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a>    <span class="p">}</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>    <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">matrix</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">voigt_matrices</span><span class="p">):</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>        <span class="n">voigt_matrix</span> <span class="o">=</span> <span class="n">_tensors</span><span class="o">.</span><span class="n">upper_tri_to_symmetric</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>        <span class="n">stiffness_dilat</span><span class="p">,</span> <span class="n">stiffness_deviat</span> <span class="o">=</span> <span class="n">_tensors</span><span class="o">.</span><span class="n">voigt_decompose</span><span class="p">(</span><span class="n">voigt_matrix</span><span class="p">)</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>        <span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">stiffness_dilat</span><span class="p">)</span> <span class="o">/</span> <span class="mi">9</span>  <span class="c1"># Bulk modulus</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>        <span class="n">G</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">stiffness_deviat</span><span class="p">)</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">K</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10</span>  <span class="c1"># Shear modulus</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a>        <span class="n">out</span><span class="p">[</span><span class="s2">&quot;bulk_modulus&quot;</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">K</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>        <span class="n">out</span><span class="p">[</span><span class="s2">&quot;shear_modulus&quot;</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">G</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a>        <span class="c1"># Appendix A5, Browaeys &amp; Chevrot, 2004.</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>        <span class="c1"># The isotropic stiffness vector is independent of the coordinate system.</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>        <span class="n">isotropic_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>            <span class="p">(</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">K</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">G</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">K</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">G</span> <span class="o">/</span> <span class="mi">3</span><span class="p">),</span> <span class="mi">3</span><span class="p">),</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">G</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a>            <span class="p">)</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a>        <span class="p">)</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>        <span class="n">voigt_vector</span> <span class="o">=</span> <span class="n">_tensors</span><span class="o">.</span><span class="n">voigt_matrix_to_vector</span><span class="p">(</span><span class="n">voigt_matrix</span><span class="p">)</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>        <span class="n">out</span><span class="p">[</span><span class="s2">&quot;percent_anisotropy&quot;</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>            <span class="n">la</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">voigt_vector</span> <span class="o">-</span> <span class="n">isotropic_vector</span><span class="p">)</span> <span class="o">/</span> <span class="n">la</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">voigt_vector</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>        <span class="p">)</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>        <span class="c1"># Search for SCCS axes (orthogonal axes defined intrinsically by</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>        <span class="c1"># eigenstrains of the elastic tensor).</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>        <span class="n">unpermuted_SCCS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>        <span class="n">eigv_dij</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">stiffness_dilat</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>        <span class="n">eigv_vij</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">stiffness_deviat</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>        <span class="c1"># Averaging of eigenvectors to get the symmetry axes.</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>            <span class="n">index_vij</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># [i(+1?)] of v_ij = eigvect that is nearest to the d_ij one.</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>            <span class="n">angle</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># Initialise to any number &gt; 2π radians.</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>                <span class="c1"># Calculate angle between a pair of eigenvectors.</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>                <span class="c1"># One eigenvector is taken from v_ij and one from d_ij.</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>                <span class="c1"># Do not distinguish between vectors in opposite directions.</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>                <span class="n">dot_eigvects</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">eigv_dij</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="n">eigv_vij</span><span class="p">[:,</span> <span class="n">j</span><span class="p">])</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>                <span class="n">angle_eigvects</span> <span class="o">=</span> <span class="n">smallest_angle</span><span class="p">(</span><span class="n">eigv_dij</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="n">eigv_vij</span><span class="p">[:,</span> <span class="n">j</span><span class="p">])</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>                <span class="k">if</span> <span class="n">angle_eigvects</span> <span class="o">&lt;</span> <span class="n">angle</span><span class="p">:</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>                    <span class="n">angle</span> <span class="o">=</span> <span class="n">angle_eigvects</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>                    <span class="c1"># NOTE: Differences between ASPECT And original implementation:</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>                    <span class="c1"># - In C++, std::copysign(1.0, 0.0) returns -1.</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>                    <span class="c1"># - In Fortran 90, sign(1.0, 0.0) returns 1.</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>                    <span class="c1"># - ASPECT implementation uses &#39;j&#39; instead of &#39;j+1&#39;, doesn&#39;t seem to</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>                    <span class="c1"># make a difference using the equivalent change for vec_SCSS = ...</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>                    <span class="n">index_vij</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">dot_eigvects</span><span class="p">)</span> <span class="o">*</span> <span class="n">j</span> <span class="k">if</span> <span class="n">dot_eigvects</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">j</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>                    <span class="c1"># index_vij = (</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>                    <span class="c1">#     np.sign(dot_eigvects) * (j + 1)</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>                    <span class="c1">#     if dot_eigvects != 0</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>                    <span class="c1">#     else (j + 1)</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>                    <span class="c1"># )</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>            <span class="c1"># Add/subtract the nearest v_ij eigenvector multiplied by the signed index,</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>            <span class="c1"># which effectively rotates the d_ij eigenvector, and then normalise it.</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>            <span class="n">vec_SCCS</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>                <span class="n">eigv_dij</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">index_vij</span> <span class="o">*</span> <span class="n">eigv_vij</span><span class="p">[:,</span> <span class="nb">int</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">index_vij</span><span class="p">))]</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>            <span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>            <span class="c1"># vec_SCSS = (</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>            <span class="c1">#     eigv_dij[:, i] + index_vij * eigv_vij[:, int(abs(index_vij) - 1)]</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>            <span class="c1"># ) / 2</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>            <span class="n">vec_SCCS</span> <span class="o">/=</span> <span class="n">la</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vec_SCCS</span><span class="p">)</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>            <span class="n">unpermuted_SCCS</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">vec_SCCS</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>        <span class="c1"># Determine SCCS permutation that gives best hexagonal approximation.</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>        <span class="c1"># This is achieved by minimising the &quot;distance&quot; between the voigt vector and its</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>        <span class="c1"># projection onto the hexagonal symmetry subspace.</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>        <span class="c1"># The elastic tensor is rotated into this system for decomposition.</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>        <span class="n">elastic_tensor</span> <span class="o">=</span> <span class="n">_tensors</span><span class="o">.</span><span class="n">voigt_to_elastic_tensor</span><span class="p">(</span><span class="n">voigt_matrix</span><span class="p">)</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>        <span class="n">distance</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">voigt_vector</span><span class="p">)</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>            <span class="n">permuted_SCCS</span> <span class="o">=</span> <span class="n">unpermuted_SCCS</span><span class="p">[:,</span> <span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]]</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>            <span class="n">rotated_voigt_matrix</span> <span class="o">=</span> <span class="n">_tensors</span><span class="o">.</span><span class="n">elastic_tensor_to_voigt</span><span class="p">(</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>                <span class="n">_tensors</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">elastic_tensor</span><span class="p">,</span> <span class="n">permuted_SCCS</span><span class="o">.</span><span class="n">transpose</span><span class="p">())</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>            <span class="p">)</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>            <span class="n">rotated_voigt_vector</span> <span class="o">=</span> <span class="n">_tensors</span><span class="o">.</span><span class="n">voigt_matrix_to_vector</span><span class="p">(</span><span class="n">rotated_voigt_matrix</span><span class="p">)</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>            <span class="n">mono_and_higher_vector</span> <span class="o">=</span> <span class="n">_tensors</span><span class="o">.</span><span class="n">mono_project</span><span class="p">(</span><span class="n">rotated_voigt_vector</span><span class="p">)</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>            <span class="n">tric_vector</span> <span class="o">=</span> <span class="n">rotated_voigt_vector</span> <span class="o">-</span> <span class="n">mono_and_higher_vector</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>            <span class="n">ortho_and_higher_vector</span> <span class="o">=</span> <span class="n">_tensors</span><span class="o">.</span><span class="n">ortho_project</span><span class="p">(</span><span class="n">mono_and_higher_vector</span><span class="p">)</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>            <span class="n">tetr_and_higher_vector</span> <span class="o">=</span> <span class="n">_tensors</span><span class="o">.</span><span class="n">tetr_project</span><span class="p">(</span><span class="n">ortho_and_higher_vector</span><span class="p">)</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>            <span class="n">hex_and_higher_vector</span> <span class="o">=</span> <span class="n">_tensors</span><span class="o">.</span><span class="n">hex_project</span><span class="p">(</span><span class="n">tetr_and_higher_vector</span><span class="p">)</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>            <span class="n">mono_vector</span> <span class="o">=</span> <span class="n">mono_and_higher_vector</span> <span class="o">-</span> <span class="n">ortho_and_higher_vector</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>            <span class="n">ortho_vector</span> <span class="o">=</span> <span class="n">ortho_and_higher_vector</span> <span class="o">-</span> <span class="n">tetr_and_higher_vector</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>            <span class="n">tetr_vector</span> <span class="o">=</span> <span class="n">tetr_and_higher_vector</span> <span class="o">-</span> <span class="n">hex_and_higher_vector</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>            <span class="n">hex_vector</span> <span class="o">=</span> <span class="n">hex_and_higher_vector</span> <span class="o">-</span> <span class="n">isotropic_vector</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>            <span class="n">δ</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">rotated_voigt_vector</span> <span class="o">-</span> <span class="n">hex_and_higher_vector</span><span class="p">)</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>            <span class="k">if</span> <span class="n">δ</span> <span class="o">&lt;</span> <span class="n">distance</span><span class="p">:</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>                <span class="n">distance</span> <span class="o">=</span> <span class="n">δ</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>                <span class="n">percent</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">/</span> <span class="n">la</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">voigt_vector</span><span class="p">)</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>                <span class="c1"># print(&quot;\n&quot;, _tensors.voigt_vector_to_matrix(hex_vector))</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>                <span class="n">out</span><span class="p">[</span><span class="s2">&quot;percent_triclinic&quot;</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">tric_vector</span><span class="p">)</span> <span class="o">*</span> <span class="n">percent</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>                <span class="n">out</span><span class="p">[</span><span class="s2">&quot;percent_monoclinic&quot;</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">mono_vector</span><span class="p">)</span> <span class="o">*</span> <span class="n">percent</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>                <span class="n">out</span><span class="p">[</span><span class="s2">&quot;percent_orthorhombic&quot;</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">ortho_vector</span><span class="p">)</span> <span class="o">*</span> <span class="n">percent</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>                <span class="n">out</span><span class="p">[</span><span class="s2">&quot;percent_tetragonal&quot;</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">tetr_vector</span><span class="p">)</span> <span class="o">*</span> <span class="n">percent</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>                <span class="n">out</span><span class="p">[</span><span class="s2">&quot;percent_hexagonal&quot;</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">hex_vector</span><span class="p">)</span> <span class="o">*</span> <span class="n">percent</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>                <span class="c1"># Last SCCS axis is always the hexagonal symmetry axis.</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>                <span class="n">out</span><span class="p">[</span><span class="s2">&quot;hexagonal_axis&quot;</span><span class="p">][</span><span class="n">m</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">permuted_SCCS</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>    <span class="k">return</span> <span class="n">out</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a><span class="k">def</span> <span class="nf">bingham_average</span><span class="p">(</span><span class="n">orientations</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">):</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute Bingham average of orientation matrices.</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a><span class="sd">    Returns the antipodally symmetric average orientation</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a><span class="sd">    of the given crystallographic `axis`, or the a-axis by default.</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a><span class="sd">    Valid axis specifiers are &quot;a&quot; for [100], &quot;b&quot; for [010] and &quot;c&quot; for [001].</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a><span class="sd">    See also: [Watson (1966)](https://doi.org/10.1086%2F627211),</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a><span class="sd">    [Mardia &amp; Jupp, “Directional Statistics”](https://doi.org/10.1002/9780470316979).</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>    <span class="k">match</span> <span class="n">axis</span><span class="p">:</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>        <span class="k">case</span> <span class="s2">&quot;a&quot;</span><span class="p">:</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>            <span class="n">row</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>        <span class="k">case</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>            <span class="n">row</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>        <span class="k">case</span> <span class="s2">&quot;c&quot;</span><span class="p">:</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>            <span class="n">row</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>        <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;axis must be &#39;a&#39;, &#39;b&#39;, or &#39;c&#39;, not </span><span class="si">{</span><span class="n">axis</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>    <span class="c1"># https://courses.eas.ualberta.ca/eas421/lecturepages/orientation.html</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>    <span class="c1"># Eigenvector corresponding to largest eigenvalue is the mean direction.</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>    <span class="c1"># SciPy returns eigenvalues in ascending order (same order for vectors).</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>    <span class="c1"># SciPy uses lower triangular entries by default, no need for all components.</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>    <span class="n">mean_vector</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">_stats</span><span class="o">.</span><span class="n">_scatter_matrix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">orientations</span><span class="p">),</span> <span class="n">row</span><span class="p">))[</span><span class="mi">1</span><span class="p">][</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>        <span class="p">:,</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>    <span class="p">]</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>    <span class="k">return</span> <span class="n">mean_vector</span> <span class="o">/</span> <span class="n">la</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">mean_vector</span><span class="p">)</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a><span class="k">def</span> <span class="nf">finite_strain</span><span class="p">(</span><span class="n">deformation_gradient</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract measures of finite strain from the deformation gradient.</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a><span class="sd">    Extracts the largest principal strain value and the vector defining the axis of</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a><span class="sd">    maximum extension (longest semiaxis of the finite strain ellipsoid) from the 3x3</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a><span class="sd">    deformation gradient tensor.</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>    <span class="c1"># Get eigenvalues and eigenvectors of the left stretch (Cauchy-Green) tensor.</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>    <span class="n">B_λ</span><span class="p">,</span> <span class="n">B_v</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>        <span class="n">deformation_gradient</span> <span class="o">@</span> <span class="n">deformation_gradient</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>        <span class="n">driver</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;driver&quot;</span><span class="p">,</span> <span class="s2">&quot;ev&quot;</span><span class="p">),</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>    <span class="p">)</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>    <span class="c1"># Stretch ratio is sqrt(λ) - 1, the (-1) is so that undeformed strain is 0 not 1.</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">B_λ</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">B_v</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a><span class="k">def</span> <span class="nf">symmetry</span><span class="p">(</span><span class="n">orientations</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">):</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Compute texture symmetry eigenvalue diagnostics from grain orientation matrices.</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a><span class="sd">    Compute Point, Girdle and Random symmetry diagnostics</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a><span class="sd">    for ternary texture classification.</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a><span class="sd">    Returns the tuple (P, G, R) where</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a><span class="sd">    $$</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a><span class="sd">    \begin{align\*}</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a><span class="sd">    P &amp;= (λ_{1} - λ_{2}) / N \cr</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a><span class="sd">    G &amp;= 2 (λ_{2} - λ_{3}) / N \cr</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a><span class="sd">    R &amp;= 3 λ_{3} / N</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a><span class="sd">    \end{align\*}</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a><span class="sd">    $$</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a><span class="sd">    with $N$ the sum of the eigenvalues $λ_{1} ≥ λ_{2} ≥ λ_{3}$</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a><span class="sd">    of the scatter (inertia) matrix.</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a><span class="sd">    See e.g. [Vollmer (1990)](https://doi.org/10.1130/0016-7606(1990)102%3C0786:AAOEMT%3E2.3.CO;2).</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>    <span class="k">match</span> <span class="n">axis</span><span class="p">:</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>        <span class="k">case</span> <span class="s2">&quot;a&quot;</span><span class="p">:</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>            <span class="n">row</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>        <span class="k">case</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>            <span class="n">row</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>        <span class="k">case</span> <span class="s2">&quot;c&quot;</span><span class="p">:</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>            <span class="n">row</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>        <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;axis must be &#39;a&#39;, &#39;b&#39;, or &#39;c&#39;, not </span><span class="si">{</span><span class="n">axis</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>    <span class="n">scatter</span> <span class="o">=</span> <span class="n">_stats</span><span class="o">.</span><span class="n">_scatter_matrix</span><span class="p">(</span><span class="n">orientations</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>    <span class="c1"># SciPy uses lower triangular entries by default, no need for all components.</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>    <span class="n">eigvals_descending</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">eigvalsh</span><span class="p">(</span><span class="n">scatter</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>    <span class="n">sum_eigvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">eigvals_descending</span><span class="p">)</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>    <span class="k">return</span> <span class="p">(</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>        <span class="p">(</span><span class="n">eigvals_descending</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">eigvals_descending</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">sum_eigvals</span><span class="p">,</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>        <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">eigvals_descending</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">eigvals_descending</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="n">sum_eigvals</span><span class="p">,</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>        <span class="mi">3</span> <span class="o">*</span> <span class="n">eigvals_descending</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">sum_eigvals</span><span class="p">,</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>    <span class="p">)</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a><span class="k">def</span> <span class="nf">misorientation_indices</span><span class="p">(</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>    <span class="n">orientation_stack</span><span class="p">,</span> <span class="n">system</span><span class="p">:</span> <span class="n">_geo</span><span class="o">.</span><span class="n">LatticeSystem</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ncpus</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pool</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a><span class="p">):</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate M-indices for a series of polycrystal textures.</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a><span class="sd">    Calculate M-index using `misorientation_index` for a series of texture snapshots.</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a><span class="sd">    The `orientation_stack` is a NxMx3x3 array of orientations where N is the number of</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a><span class="sd">    texture snapshots and M is the number of grains.</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a><span class="sd">    Uses the multiprocessing library to calculate texture indices for multiple snapshots</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a><span class="sd">    simultaneously. If `ncpus` is `None` the number of CPU cores to use is chosen</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a><span class="sd">    automatically based on the maximum number available to the Python interpreter,</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a><span class="sd">    otherwise the specified number of cores is requested. Alternatively, an existing</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a><span class="sd">    instance of `multiprocessing.Pool` can be provided.</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a><span class="sd">    See `misorientation_index` for documentation of the remaining arguments.</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>    <span class="k">if</span> <span class="n">ncpus</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">pool</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>        <span class="n">_log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;ignoring `ncpus` argument because a Pool was provided&quot;</span><span class="p">)</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>    <span class="n">m_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">orientation_stack</span><span class="p">))</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>    <span class="n">_run</span> <span class="o">=</span> <span class="n">ft</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>        <span class="n">misorientation_index</span><span class="p">,</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>        <span class="n">system</span><span class="o">=</span><span class="n">system</span><span class="p">,</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>        <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>    <span class="p">)</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>    <span class="k">if</span> <span class="n">pool</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>        <span class="k">if</span> <span class="n">ncpus</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>            <span class="n">ncpus</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sched_getaffinity</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>        <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="n">ncpus</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">out</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pool</span><span class="o">.</span><span class="n">imap</span><span class="p">(</span><span class="n">_run</span><span class="p">,</span> <span class="n">orientation_stack</span><span class="p">)):</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a>                <span class="n">m_indices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">out</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pool</span><span class="o">.</span><span class="n">imap</span><span class="p">(</span><span class="n">_run</span><span class="p">,</span> <span class="n">orientation_stack</span><span class="p">)):</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>            <span class="n">m_indices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>    <span class="k">return</span> <span class="n">m_indices</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a><span class="k">def</span> <span class="nf">misorientation_index</span><span class="p">(</span><span class="n">orientations</span><span class="p">,</span> <span class="n">system</span><span class="p">:</span> <span class="n">_geo</span><span class="o">.</span><span class="n">LatticeSystem</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate M-index for polycrystal orientations.</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a><span class="sd">    The `bins` argument is passed to `numpy.histogram`.</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a><span class="sd">    If left as `None`, 1° bins will be used as recommended by the reference paper.</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a><span class="sd">    The `symmetry` argument specifies the lattice system which determines intrinsic</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a><span class="sd">    symmetry degeneracies and the maximum allowable misorientation angle.</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a><span class="sd">    See `_geo.LatticeSystem` for supported systems.</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a><span class="sd">    .. warning::</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a><span class="sd">        This method must be able to allocate an array of shape </span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a><span class="sd">        $ \frac{N!}{2(N-2)!}× M^{2} $</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a><span class="sd">        for N the length of `orientations` and M the number of symmetry operations for</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a><span class="sd">        the given `system`.</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a><span class="sd">    See [Skemer et al. (2005)](https://doi.org/10.1016/j.tecto.2005.08.023).</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a>    <span class="n">θmax</span> <span class="o">=</span> <span class="n">_stats</span><span class="o">.</span><span class="n">_max_misorientation</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>    <span class="n">misorientations_count</span><span class="p">,</span> <span class="n">bin_edges</span> <span class="o">=</span> <span class="n">_stats</span><span class="o">.</span><span class="n">misorientation_hist</span><span class="p">(</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a>        <span class="n">orientations</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="n">bins</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>    <span class="p">)</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a>    <span class="c1"># Compute counts of theoretical misorientation for an isotropic aggregate,</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a>    <span class="c1"># using the same bins (Skemer 2005 recommend 1° bins).</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>    <span class="n">misorientations_theory</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>        <span class="p">[</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a>            <span class="n">_stats</span><span class="o">.</span><span class="n">misorientations_random</span><span class="p">(</span><span class="n">bin_edges</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">bin_edges</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">system</span><span class="p">)</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">misorientations_count</span><span class="p">))</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a>        <span class="p">]</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>    <span class="p">)</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a>    <span class="c1"># Equation 2 in Skemer 2005.</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a>    <span class="k">return</span> <span class="p">(</span><span class="n">θmax</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">misorientations_count</span><span class="p">)))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a>        <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">misorientations_theory</span> <span class="o">-</span> <span class="n">misorientations_count</span><span class="p">)</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>    <span class="p">)</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a><span class="k">def</span> <span class="nf">coaxial_index</span><span class="p">(</span><span class="n">orientations</span><span class="p">,</span> <span class="n">axis1</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">axis2</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">):</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate coaxial “BA” index for a combination of two crystal axes.</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a><span class="sd">    The BA index of [Mainprice et al. (2015)](https://doi.org/10.1144/SP409.8)</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a><span class="sd">    is derived from the eigenvalue `symmetry` diagnostics and measures point vs girdle</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a><span class="sd">    symmetry in the aggregate. $BA ∈ [0, 1]$ where $BA = 0$ corresponds to a perfect</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a><span class="sd">    axial girdle texture and $BA = 1$ represents a point symmetry texture assuming that</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a><span class="sd">    the random component $R$ is negligible. May be less susceptible to random</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a><span class="sd">    fluctuations compared to the raw eigenvalue diagnostics.</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>    <span class="n">P1</span><span class="p">,</span> <span class="n">G1</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">symmetry</span><span class="p">(</span><span class="n">orientations</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis1</span><span class="p">)</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>    <span class="n">P2</span><span class="p">,</span> <span class="n">G2</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">symmetry</span><span class="p">(</span><span class="n">orientations</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis2</span><span class="p">)</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a>    <span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">P1</span> <span class="o">/</span> <span class="p">(</span><span class="n">G1</span> <span class="o">+</span> <span class="n">P1</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span><span class="n">G2</span> <span class="o">/</span> <span class="p">(</span><span class="n">G2</span> <span class="o">+</span> <span class="n">P2</span><span class="p">)))</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a><span class="k">def</span> <span class="nf">smallest_angle</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">plane</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get smallest angle between a unit `vector` and a bidirectional `axis`.</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a><span class="sd">    The axis is specified using either of its two parallel unit vectors.</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a><span class="sd">    Optionally project the vector onto the `plane` (given by its unit normal)</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a><span class="sd">    before calculating the angle.</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>    <span class="k">if</span> <span class="n">plane</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>        <span class="n">_plane</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">plane</span><span class="p">)</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>        <span class="n">_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span> <span class="o">-</span> <span class="n">_plane</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="n">_plane</span><span class="p">)</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>        <span class="n">_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>    <span class="n">angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>        <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">_vector</span><span class="p">,</span> <span class="n">axis</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">la</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">_vector</span><span class="p">)</span> <span class="o">*</span> <span class="n">la</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">axis</span><span class="p">)),</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>        <span class="p">)</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>    <span class="p">)</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>    <span class="k">if</span> <span class="n">angle</span> <span class="o">&gt;</span> <span class="mi">90</span><span class="p">:</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>        <span class="k">return</span> <span class="mi">180</span> <span class="o">-</span> <span class="n">angle</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a>    <span class="k">return</span> <span class="n">angle</span>
</span></pre></div>


            </section>
                <section id="elasticity_components">
                            <input id="elasticity_components-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">elasticity_components</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">voigt_matrices</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="elasticity_components-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#elasticity_components"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="elasticity_components-32"><a href="#elasticity_components-32"><span class="linenos"> 32</span></a><span class="k">def</span> <span class="nf">elasticity_components</span><span class="p">(</span><span class="n">voigt_matrices</span><span class="p">):</span>
</span><span id="elasticity_components-33"><a href="#elasticity_components-33"><span class="linenos"> 33</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate elasticity decompositions for the given elasticity tensors.</span>
</span><span id="elasticity_components-34"><a href="#elasticity_components-34"><span class="linenos"> 34</span></a>
</span><span id="elasticity_components-35"><a href="#elasticity_components-35"><span class="linenos"> 35</span></a><span class="sd">    Args:</span>
</span><span id="elasticity_components-36"><a href="#elasticity_components-36"><span class="linenos"> 36</span></a><span class="sd">    - `voigt_matrices` (array) — the Nx6x6 Voigt matrix representations of the averaged</span>
</span><span id="elasticity_components-37"><a href="#elasticity_components-37"><span class="linenos"> 37</span></a><span class="sd">      elasticity tensors for a series of polycrystal textures</span>
</span><span id="elasticity_components-38"><a href="#elasticity_components-38"><span class="linenos"> 38</span></a>
</span><span id="elasticity_components-39"><a href="#elasticity_components-39"><span class="linenos"> 39</span></a><span class="sd">    Returns a dictionary with the following data series:</span>
</span><span id="elasticity_components-40"><a href="#elasticity_components-40"><span class="linenos"> 40</span></a><span class="sd">    - `&#39;bulk_modulus&#39;` — the computed bulk modulus for each Voigt matrix C</span>
</span><span id="elasticity_components-41"><a href="#elasticity_components-41"><span class="linenos"> 41</span></a><span class="sd">    - `&#39;shear_modulus&#39;` — the computed shear modulus for each Voigt matrix C</span>
</span><span id="elasticity_components-42"><a href="#elasticity_components-42"><span class="linenos"> 42</span></a><span class="sd">    - `&#39;percent_anisotropy&#39;` — for each Voigt matrix C, the total percentage of the</span>
</span><span id="elasticity_components-43"><a href="#elasticity_components-43"><span class="linenos"> 43</span></a><span class="sd">      norm of the elastic tensor ||C|| that deviates from the norm of the &quot;closest&quot;</span>
</span><span id="elasticity_components-44"><a href="#elasticity_components-44"><span class="linenos"> 44</span></a><span class="sd">      isotropic elasticity tensor</span>
</span><span id="elasticity_components-45"><a href="#elasticity_components-45"><span class="linenos"> 45</span></a><span class="sd">    - `&#39;percent_hexagonal&#39;` — for each C, the percentage of ||C|| attributed to</span>
</span><span id="elasticity_components-46"><a href="#elasticity_components-46"><span class="linenos"> 46</span></a><span class="sd">      hexagonally symmetric minerals</span>
</span><span id="elasticity_components-47"><a href="#elasticity_components-47"><span class="linenos"> 47</span></a><span class="sd">    - `&#39;percent_tetragonal&#39;` — for each C, the percentage of ||C|| attributed to</span>
</span><span id="elasticity_components-48"><a href="#elasticity_components-48"><span class="linenos"> 48</span></a><span class="sd">      tetragonally symmetric minerals</span>
</span><span id="elasticity_components-49"><a href="#elasticity_components-49"><span class="linenos"> 49</span></a><span class="sd">    - `&#39;percent_orthorhombic&#39;` — for each C, the percentage of ||C|| attributed to</span>
</span><span id="elasticity_components-50"><a href="#elasticity_components-50"><span class="linenos"> 50</span></a><span class="sd">      orthorhombically symmetric minerals</span>
</span><span id="elasticity_components-51"><a href="#elasticity_components-51"><span class="linenos"> 51</span></a><span class="sd">    - `&#39;percent_monoclinic&#39;` — for each C, the percentage of ||C|| attributed to</span>
</span><span id="elasticity_components-52"><a href="#elasticity_components-52"><span class="linenos"> 52</span></a><span class="sd">      monoclinically symmetric minerals</span>
</span><span id="elasticity_components-53"><a href="#elasticity_components-53"><span class="linenos"> 53</span></a><span class="sd">    - `&#39;percent_triclinic&#39;` — for each C, the percentage of ||C|| attributed to</span>
</span><span id="elasticity_components-54"><a href="#elasticity_components-54"><span class="linenos"> 54</span></a><span class="sd">      triclinically &quot;symmetric&quot; minerals (no mirror planes)</span>
</span><span id="elasticity_components-55"><a href="#elasticity_components-55"><span class="linenos"> 55</span></a><span class="sd">    - `&#39;hexagonal_axis&#39;` — for each C, the axis of hexagonal symmetry for the &quot;closest&quot;</span>
</span><span id="elasticity_components-56"><a href="#elasticity_components-56"><span class="linenos"> 56</span></a><span class="sd">      hexagonally symmetric approximation to C, a.k.a. the &quot;transverse isotropy&quot; axis</span>
</span><span id="elasticity_components-57"><a href="#elasticity_components-57"><span class="linenos"> 57</span></a>
</span><span id="elasticity_components-58"><a href="#elasticity_components-58"><span class="linenos"> 58</span></a><span class="sd">    .. note::</span>
</span><span id="elasticity_components-59"><a href="#elasticity_components-59"><span class="linenos"> 59</span></a><span class="sd">        Only 5 symmetry classes are relevant for elasticity decomposition,</span>
</span><span id="elasticity_components-60"><a href="#elasticity_components-60"><span class="linenos"> 60</span></a><span class="sd">        compared to the usual 6 used to describe crystal families.</span>
</span><span id="elasticity_components-61"><a href="#elasticity_components-61"><span class="linenos"> 61</span></a><span class="sd">        Crystals with cubic symmetry contribute to the isotropic elasticity tensor,</span>
</span><span id="elasticity_components-62"><a href="#elasticity_components-62"><span class="linenos"> 62</span></a><span class="sd">        because the lattice spacing is identical in all orthogonal directions.</span>
</span><span id="elasticity_components-63"><a href="#elasticity_components-63"><span class="linenos"> 63</span></a><span class="sd">        Note also that the trigonal crystal *system* is not a crystal family</span>
</span><span id="elasticity_components-64"><a href="#elasticity_components-64"><span class="linenos"> 64</span></a><span class="sd">        (it belongs to the hexagonal family).</span>
</span><span id="elasticity_components-65"><a href="#elasticity_components-65"><span class="linenos"> 65</span></a>
</span><span id="elasticity_components-66"><a href="#elasticity_components-66"><span class="linenos"> 66</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="elasticity_components-67"><a href="#elasticity_components-67"><span class="linenos"> 67</span></a>    <span class="n">n_matrices</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">voigt_matrices</span><span class="p">)</span>
</span><span id="elasticity_components-68"><a href="#elasticity_components-68"><span class="linenos"> 68</span></a>    <span class="n">out</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="elasticity_components-69"><a href="#elasticity_components-69"><span class="linenos"> 69</span></a>        <span class="s2">&quot;bulk_modulus&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">n_matrices</span><span class="p">),</span>
</span><span id="elasticity_components-70"><a href="#elasticity_components-70"><span class="linenos"> 70</span></a>        <span class="s2">&quot;shear_modulus&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">n_matrices</span><span class="p">),</span>
</span><span id="elasticity_components-71"><a href="#elasticity_components-71"><span class="linenos"> 71</span></a>        <span class="s2">&quot;percent_anisotropy&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">n_matrices</span><span class="p">),</span>
</span><span id="elasticity_components-72"><a href="#elasticity_components-72"><span class="linenos"> 72</span></a>        <span class="s2">&quot;percent_hexagonal&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">n_matrices</span><span class="p">),</span>
</span><span id="elasticity_components-73"><a href="#elasticity_components-73"><span class="linenos"> 73</span></a>        <span class="s2">&quot;percent_tetragonal&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">n_matrices</span><span class="p">),</span>
</span><span id="elasticity_components-74"><a href="#elasticity_components-74"><span class="linenos"> 74</span></a>        <span class="s2">&quot;percent_orthorhombic&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">n_matrices</span><span class="p">),</span>
</span><span id="elasticity_components-75"><a href="#elasticity_components-75"><span class="linenos"> 75</span></a>        <span class="s2">&quot;percent_monoclinic&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">n_matrices</span><span class="p">),</span>
</span><span id="elasticity_components-76"><a href="#elasticity_components-76"><span class="linenos"> 76</span></a>        <span class="s2">&quot;percent_triclinic&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">n_matrices</span><span class="p">),</span>
</span><span id="elasticity_components-77"><a href="#elasticity_components-77"><span class="linenos"> 77</span></a>        <span class="s2">&quot;hexagonal_axis&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">n_matrices</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span>
</span><span id="elasticity_components-78"><a href="#elasticity_components-78"><span class="linenos"> 78</span></a>    <span class="p">}</span>
</span><span id="elasticity_components-79"><a href="#elasticity_components-79"><span class="linenos"> 79</span></a>    <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">matrix</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">voigt_matrices</span><span class="p">):</span>
</span><span id="elasticity_components-80"><a href="#elasticity_components-80"><span class="linenos"> 80</span></a>        <span class="n">voigt_matrix</span> <span class="o">=</span> <span class="n">_tensors</span><span class="o">.</span><span class="n">upper_tri_to_symmetric</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>
</span><span id="elasticity_components-81"><a href="#elasticity_components-81"><span class="linenos"> 81</span></a>        <span class="n">stiffness_dilat</span><span class="p">,</span> <span class="n">stiffness_deviat</span> <span class="o">=</span> <span class="n">_tensors</span><span class="o">.</span><span class="n">voigt_decompose</span><span class="p">(</span><span class="n">voigt_matrix</span><span class="p">)</span>
</span><span id="elasticity_components-82"><a href="#elasticity_components-82"><span class="linenos"> 82</span></a>        <span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">stiffness_dilat</span><span class="p">)</span> <span class="o">/</span> <span class="mi">9</span>  <span class="c1"># Bulk modulus</span>
</span><span id="elasticity_components-83"><a href="#elasticity_components-83"><span class="linenos"> 83</span></a>        <span class="n">G</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">stiffness_deviat</span><span class="p">)</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">K</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10</span>  <span class="c1"># Shear modulus</span>
</span><span id="elasticity_components-84"><a href="#elasticity_components-84"><span class="linenos"> 84</span></a>        <span class="n">out</span><span class="p">[</span><span class="s2">&quot;bulk_modulus&quot;</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">K</span>
</span><span id="elasticity_components-85"><a href="#elasticity_components-85"><span class="linenos"> 85</span></a>        <span class="n">out</span><span class="p">[</span><span class="s2">&quot;shear_modulus&quot;</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">G</span>
</span><span id="elasticity_components-86"><a href="#elasticity_components-86"><span class="linenos"> 86</span></a>
</span><span id="elasticity_components-87"><a href="#elasticity_components-87"><span class="linenos"> 87</span></a>        <span class="c1"># Appendix A5, Browaeys &amp; Chevrot, 2004.</span>
</span><span id="elasticity_components-88"><a href="#elasticity_components-88"><span class="linenos"> 88</span></a>        <span class="c1"># The isotropic stiffness vector is independent of the coordinate system.</span>
</span><span id="elasticity_components-89"><a href="#elasticity_components-89"><span class="linenos"> 89</span></a>        <span class="n">isotropic_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
</span><span id="elasticity_components-90"><a href="#elasticity_components-90"><span class="linenos"> 90</span></a>            <span class="p">(</span>
</span><span id="elasticity_components-91"><a href="#elasticity_components-91"><span class="linenos"> 91</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">K</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">G</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
</span><span id="elasticity_components-92"><a href="#elasticity_components-92"><span class="linenos"> 92</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">K</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">G</span> <span class="o">/</span> <span class="mi">3</span><span class="p">),</span> <span class="mi">3</span><span class="p">),</span>
</span><span id="elasticity_components-93"><a href="#elasticity_components-93"><span class="linenos"> 93</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">G</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
</span><span id="elasticity_components-94"><a href="#elasticity_components-94"><span class="linenos"> 94</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span>
</span><span id="elasticity_components-95"><a href="#elasticity_components-95"><span class="linenos"> 95</span></a>            <span class="p">)</span>
</span><span id="elasticity_components-96"><a href="#elasticity_components-96"><span class="linenos"> 96</span></a>        <span class="p">)</span>
</span><span id="elasticity_components-97"><a href="#elasticity_components-97"><span class="linenos"> 97</span></a>        <span class="n">voigt_vector</span> <span class="o">=</span> <span class="n">_tensors</span><span class="o">.</span><span class="n">voigt_matrix_to_vector</span><span class="p">(</span><span class="n">voigt_matrix</span><span class="p">)</span>
</span><span id="elasticity_components-98"><a href="#elasticity_components-98"><span class="linenos"> 98</span></a>        <span class="n">out</span><span class="p">[</span><span class="s2">&quot;percent_anisotropy&quot;</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="elasticity_components-99"><a href="#elasticity_components-99"><span class="linenos"> 99</span></a>            <span class="n">la</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">voigt_vector</span> <span class="o">-</span> <span class="n">isotropic_vector</span><span class="p">)</span> <span class="o">/</span> <span class="n">la</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">voigt_vector</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
</span><span id="elasticity_components-100"><a href="#elasticity_components-100"><span class="linenos">100</span></a>        <span class="p">)</span>
</span><span id="elasticity_components-101"><a href="#elasticity_components-101"><span class="linenos">101</span></a>
</span><span id="elasticity_components-102"><a href="#elasticity_components-102"><span class="linenos">102</span></a>        <span class="c1"># Search for SCCS axes (orthogonal axes defined intrinsically by</span>
</span><span id="elasticity_components-103"><a href="#elasticity_components-103"><span class="linenos">103</span></a>        <span class="c1"># eigenstrains of the elastic tensor).</span>
</span><span id="elasticity_components-104"><a href="#elasticity_components-104"><span class="linenos">104</span></a>        <span class="n">unpermuted_SCCS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</span><span id="elasticity_components-105"><a href="#elasticity_components-105"><span class="linenos">105</span></a>        <span class="n">eigv_dij</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">stiffness_dilat</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="elasticity_components-106"><a href="#elasticity_components-106"><span class="linenos">106</span></a>        <span class="n">eigv_vij</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">stiffness_deviat</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="elasticity_components-107"><a href="#elasticity_components-107"><span class="linenos">107</span></a>        <span class="c1"># Averaging of eigenvectors to get the symmetry axes.</span>
</span><span id="elasticity_components-108"><a href="#elasticity_components-108"><span class="linenos">108</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
</span><span id="elasticity_components-109"><a href="#elasticity_components-109"><span class="linenos">109</span></a>            <span class="n">index_vij</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># [i(+1?)] of v_ij = eigvect that is nearest to the d_ij one.</span>
</span><span id="elasticity_components-110"><a href="#elasticity_components-110"><span class="linenos">110</span></a>            <span class="n">angle</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># Initialise to any number &gt; 2π radians.</span>
</span><span id="elasticity_components-111"><a href="#elasticity_components-111"><span class="linenos">111</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
</span><span id="elasticity_components-112"><a href="#elasticity_components-112"><span class="linenos">112</span></a>                <span class="c1"># Calculate angle between a pair of eigenvectors.</span>
</span><span id="elasticity_components-113"><a href="#elasticity_components-113"><span class="linenos">113</span></a>                <span class="c1"># One eigenvector is taken from v_ij and one from d_ij.</span>
</span><span id="elasticity_components-114"><a href="#elasticity_components-114"><span class="linenos">114</span></a>                <span class="c1"># Do not distinguish between vectors in opposite directions.</span>
</span><span id="elasticity_components-115"><a href="#elasticity_components-115"><span class="linenos">115</span></a>                <span class="n">dot_eigvects</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">eigv_dij</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="n">eigv_vij</span><span class="p">[:,</span> <span class="n">j</span><span class="p">])</span>
</span><span id="elasticity_components-116"><a href="#elasticity_components-116"><span class="linenos">116</span></a>                <span class="n">angle_eigvects</span> <span class="o">=</span> <span class="n">smallest_angle</span><span class="p">(</span><span class="n">eigv_dij</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="n">eigv_vij</span><span class="p">[:,</span> <span class="n">j</span><span class="p">])</span>
</span><span id="elasticity_components-117"><a href="#elasticity_components-117"><span class="linenos">117</span></a>                <span class="k">if</span> <span class="n">angle_eigvects</span> <span class="o">&lt;</span> <span class="n">angle</span><span class="p">:</span>
</span><span id="elasticity_components-118"><a href="#elasticity_components-118"><span class="linenos">118</span></a>                    <span class="n">angle</span> <span class="o">=</span> <span class="n">angle_eigvects</span>
</span><span id="elasticity_components-119"><a href="#elasticity_components-119"><span class="linenos">119</span></a>                    <span class="c1"># NOTE: Differences between ASPECT And original implementation:</span>
</span><span id="elasticity_components-120"><a href="#elasticity_components-120"><span class="linenos">120</span></a>                    <span class="c1"># - In C++, std::copysign(1.0, 0.0) returns -1.</span>
</span><span id="elasticity_components-121"><a href="#elasticity_components-121"><span class="linenos">121</span></a>                    <span class="c1"># - In Fortran 90, sign(1.0, 0.0) returns 1.</span>
</span><span id="elasticity_components-122"><a href="#elasticity_components-122"><span class="linenos">122</span></a>                    <span class="c1"># - ASPECT implementation uses &#39;j&#39; instead of &#39;j+1&#39;, doesn&#39;t seem to</span>
</span><span id="elasticity_components-123"><a href="#elasticity_components-123"><span class="linenos">123</span></a>                    <span class="c1"># make a difference using the equivalent change for vec_SCSS = ...</span>
</span><span id="elasticity_components-124"><a href="#elasticity_components-124"><span class="linenos">124</span></a>                    <span class="n">index_vij</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">dot_eigvects</span><span class="p">)</span> <span class="o">*</span> <span class="n">j</span> <span class="k">if</span> <span class="n">dot_eigvects</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">j</span>
</span><span id="elasticity_components-125"><a href="#elasticity_components-125"><span class="linenos">125</span></a>                    <span class="c1"># index_vij = (</span>
</span><span id="elasticity_components-126"><a href="#elasticity_components-126"><span class="linenos">126</span></a>                    <span class="c1">#     np.sign(dot_eigvects) * (j + 1)</span>
</span><span id="elasticity_components-127"><a href="#elasticity_components-127"><span class="linenos">127</span></a>                    <span class="c1">#     if dot_eigvects != 0</span>
</span><span id="elasticity_components-128"><a href="#elasticity_components-128"><span class="linenos">128</span></a>                    <span class="c1">#     else (j + 1)</span>
</span><span id="elasticity_components-129"><a href="#elasticity_components-129"><span class="linenos">129</span></a>                    <span class="c1"># )</span>
</span><span id="elasticity_components-130"><a href="#elasticity_components-130"><span class="linenos">130</span></a>
</span><span id="elasticity_components-131"><a href="#elasticity_components-131"><span class="linenos">131</span></a>            <span class="c1"># Add/subtract the nearest v_ij eigenvector multiplied by the signed index,</span>
</span><span id="elasticity_components-132"><a href="#elasticity_components-132"><span class="linenos">132</span></a>            <span class="c1"># which effectively rotates the d_ij eigenvector, and then normalise it.</span>
</span><span id="elasticity_components-133"><a href="#elasticity_components-133"><span class="linenos">133</span></a>            <span class="n">vec_SCCS</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="elasticity_components-134"><a href="#elasticity_components-134"><span class="linenos">134</span></a>                <span class="n">eigv_dij</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">index_vij</span> <span class="o">*</span> <span class="n">eigv_vij</span><span class="p">[:,</span> <span class="nb">int</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">index_vij</span><span class="p">))]</span>
</span><span id="elasticity_components-135"><a href="#elasticity_components-135"><span class="linenos">135</span></a>            <span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="elasticity_components-136"><a href="#elasticity_components-136"><span class="linenos">136</span></a>            <span class="c1"># vec_SCSS = (</span>
</span><span id="elasticity_components-137"><a href="#elasticity_components-137"><span class="linenos">137</span></a>            <span class="c1">#     eigv_dij[:, i] + index_vij * eigv_vij[:, int(abs(index_vij) - 1)]</span>
</span><span id="elasticity_components-138"><a href="#elasticity_components-138"><span class="linenos">138</span></a>            <span class="c1"># ) / 2</span>
</span><span id="elasticity_components-139"><a href="#elasticity_components-139"><span class="linenos">139</span></a>            <span class="n">vec_SCCS</span> <span class="o">/=</span> <span class="n">la</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vec_SCCS</span><span class="p">)</span>
</span><span id="elasticity_components-140"><a href="#elasticity_components-140"><span class="linenos">140</span></a>            <span class="n">unpermuted_SCCS</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">vec_SCCS</span>
</span><span id="elasticity_components-141"><a href="#elasticity_components-141"><span class="linenos">141</span></a>
</span><span id="elasticity_components-142"><a href="#elasticity_components-142"><span class="linenos">142</span></a>        <span class="c1"># Determine SCCS permutation that gives best hexagonal approximation.</span>
</span><span id="elasticity_components-143"><a href="#elasticity_components-143"><span class="linenos">143</span></a>        <span class="c1"># This is achieved by minimising the &quot;distance&quot; between the voigt vector and its</span>
</span><span id="elasticity_components-144"><a href="#elasticity_components-144"><span class="linenos">144</span></a>        <span class="c1"># projection onto the hexagonal symmetry subspace.</span>
</span><span id="elasticity_components-145"><a href="#elasticity_components-145"><span class="linenos">145</span></a>        <span class="c1"># The elastic tensor is rotated into this system for decomposition.</span>
</span><span id="elasticity_components-146"><a href="#elasticity_components-146"><span class="linenos">146</span></a>        <span class="n">elastic_tensor</span> <span class="o">=</span> <span class="n">_tensors</span><span class="o">.</span><span class="n">voigt_to_elastic_tensor</span><span class="p">(</span><span class="n">voigt_matrix</span><span class="p">)</span>
</span><span id="elasticity_components-147"><a href="#elasticity_components-147"><span class="linenos">147</span></a>        <span class="n">distance</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">voigt_vector</span><span class="p">)</span>
</span><span id="elasticity_components-148"><a href="#elasticity_components-148"><span class="linenos">148</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
</span><span id="elasticity_components-149"><a href="#elasticity_components-149"><span class="linenos">149</span></a>            <span class="n">permuted_SCCS</span> <span class="o">=</span> <span class="n">unpermuted_SCCS</span><span class="p">[:,</span> <span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]]</span>
</span><span id="elasticity_components-150"><a href="#elasticity_components-150"><span class="linenos">150</span></a>            <span class="n">rotated_voigt_matrix</span> <span class="o">=</span> <span class="n">_tensors</span><span class="o">.</span><span class="n">elastic_tensor_to_voigt</span><span class="p">(</span>
</span><span id="elasticity_components-151"><a href="#elasticity_components-151"><span class="linenos">151</span></a>                <span class="n">_tensors</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">elastic_tensor</span><span class="p">,</span> <span class="n">permuted_SCCS</span><span class="o">.</span><span class="n">transpose</span><span class="p">())</span>
</span><span id="elasticity_components-152"><a href="#elasticity_components-152"><span class="linenos">152</span></a>            <span class="p">)</span>
</span><span id="elasticity_components-153"><a href="#elasticity_components-153"><span class="linenos">153</span></a>            <span class="n">rotated_voigt_vector</span> <span class="o">=</span> <span class="n">_tensors</span><span class="o">.</span><span class="n">voigt_matrix_to_vector</span><span class="p">(</span><span class="n">rotated_voigt_matrix</span><span class="p">)</span>
</span><span id="elasticity_components-154"><a href="#elasticity_components-154"><span class="linenos">154</span></a>            <span class="n">mono_and_higher_vector</span> <span class="o">=</span> <span class="n">_tensors</span><span class="o">.</span><span class="n">mono_project</span><span class="p">(</span><span class="n">rotated_voigt_vector</span><span class="p">)</span>
</span><span id="elasticity_components-155"><a href="#elasticity_components-155"><span class="linenos">155</span></a>            <span class="n">tric_vector</span> <span class="o">=</span> <span class="n">rotated_voigt_vector</span> <span class="o">-</span> <span class="n">mono_and_higher_vector</span>
</span><span id="elasticity_components-156"><a href="#elasticity_components-156"><span class="linenos">156</span></a>            <span class="n">ortho_and_higher_vector</span> <span class="o">=</span> <span class="n">_tensors</span><span class="o">.</span><span class="n">ortho_project</span><span class="p">(</span><span class="n">mono_and_higher_vector</span><span class="p">)</span>
</span><span id="elasticity_components-157"><a href="#elasticity_components-157"><span class="linenos">157</span></a>            <span class="n">tetr_and_higher_vector</span> <span class="o">=</span> <span class="n">_tensors</span><span class="o">.</span><span class="n">tetr_project</span><span class="p">(</span><span class="n">ortho_and_higher_vector</span><span class="p">)</span>
</span><span id="elasticity_components-158"><a href="#elasticity_components-158"><span class="linenos">158</span></a>            <span class="n">hex_and_higher_vector</span> <span class="o">=</span> <span class="n">_tensors</span><span class="o">.</span><span class="n">hex_project</span><span class="p">(</span><span class="n">tetr_and_higher_vector</span><span class="p">)</span>
</span><span id="elasticity_components-159"><a href="#elasticity_components-159"><span class="linenos">159</span></a>            <span class="n">mono_vector</span> <span class="o">=</span> <span class="n">mono_and_higher_vector</span> <span class="o">-</span> <span class="n">ortho_and_higher_vector</span>
</span><span id="elasticity_components-160"><a href="#elasticity_components-160"><span class="linenos">160</span></a>            <span class="n">ortho_vector</span> <span class="o">=</span> <span class="n">ortho_and_higher_vector</span> <span class="o">-</span> <span class="n">tetr_and_higher_vector</span>
</span><span id="elasticity_components-161"><a href="#elasticity_components-161"><span class="linenos">161</span></a>            <span class="n">tetr_vector</span> <span class="o">=</span> <span class="n">tetr_and_higher_vector</span> <span class="o">-</span> <span class="n">hex_and_higher_vector</span>
</span><span id="elasticity_components-162"><a href="#elasticity_components-162"><span class="linenos">162</span></a>            <span class="n">hex_vector</span> <span class="o">=</span> <span class="n">hex_and_higher_vector</span> <span class="o">-</span> <span class="n">isotropic_vector</span>
</span><span id="elasticity_components-163"><a href="#elasticity_components-163"><span class="linenos">163</span></a>
</span><span id="elasticity_components-164"><a href="#elasticity_components-164"><span class="linenos">164</span></a>            <span class="n">δ</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">rotated_voigt_vector</span> <span class="o">-</span> <span class="n">hex_and_higher_vector</span><span class="p">)</span>
</span><span id="elasticity_components-165"><a href="#elasticity_components-165"><span class="linenos">165</span></a>            <span class="k">if</span> <span class="n">δ</span> <span class="o">&lt;</span> <span class="n">distance</span><span class="p">:</span>
</span><span id="elasticity_components-166"><a href="#elasticity_components-166"><span class="linenos">166</span></a>                <span class="n">distance</span> <span class="o">=</span> <span class="n">δ</span>
</span><span id="elasticity_components-167"><a href="#elasticity_components-167"><span class="linenos">167</span></a>
</span><span id="elasticity_components-168"><a href="#elasticity_components-168"><span class="linenos">168</span></a>                <span class="n">percent</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">/</span> <span class="n">la</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">voigt_vector</span><span class="p">)</span>
</span><span id="elasticity_components-169"><a href="#elasticity_components-169"><span class="linenos">169</span></a>                <span class="c1"># print(&quot;\n&quot;, _tensors.voigt_vector_to_matrix(hex_vector))</span>
</span><span id="elasticity_components-170"><a href="#elasticity_components-170"><span class="linenos">170</span></a>                <span class="n">out</span><span class="p">[</span><span class="s2">&quot;percent_triclinic&quot;</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">tric_vector</span><span class="p">)</span> <span class="o">*</span> <span class="n">percent</span>
</span><span id="elasticity_components-171"><a href="#elasticity_components-171"><span class="linenos">171</span></a>                <span class="n">out</span><span class="p">[</span><span class="s2">&quot;percent_monoclinic&quot;</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">mono_vector</span><span class="p">)</span> <span class="o">*</span> <span class="n">percent</span>
</span><span id="elasticity_components-172"><a href="#elasticity_components-172"><span class="linenos">172</span></a>                <span class="n">out</span><span class="p">[</span><span class="s2">&quot;percent_orthorhombic&quot;</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">ortho_vector</span><span class="p">)</span> <span class="o">*</span> <span class="n">percent</span>
</span><span id="elasticity_components-173"><a href="#elasticity_components-173"><span class="linenos">173</span></a>                <span class="n">out</span><span class="p">[</span><span class="s2">&quot;percent_tetragonal&quot;</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">tetr_vector</span><span class="p">)</span> <span class="o">*</span> <span class="n">percent</span>
</span><span id="elasticity_components-174"><a href="#elasticity_components-174"><span class="linenos">174</span></a>                <span class="n">out</span><span class="p">[</span><span class="s2">&quot;percent_hexagonal&quot;</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">hex_vector</span><span class="p">)</span> <span class="o">*</span> <span class="n">percent</span>
</span><span id="elasticity_components-175"><a href="#elasticity_components-175"><span class="linenos">175</span></a>                <span class="c1"># Last SCCS axis is always the hexagonal symmetry axis.</span>
</span><span id="elasticity_components-176"><a href="#elasticity_components-176"><span class="linenos">176</span></a>                <span class="n">out</span><span class="p">[</span><span class="s2">&quot;hexagonal_axis&quot;</span><span class="p">][</span><span class="n">m</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">permuted_SCCS</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
</span><span id="elasticity_components-177"><a href="#elasticity_components-177"><span class="linenos">177</span></a>    <span class="k">return</span> <span class="n">out</span>
</span></pre></div>


            <div class="docstring"><p>Calculate elasticity decompositions for the given elasticity tensors.</p>

<p>Args:</p>

<ul>
<li><code>voigt_matrices</code> (array) — the Nx6x6 Voigt matrix representations of the averaged
elasticity tensors for a series of polycrystal textures</li>
</ul>

<p>Returns a dictionary with the following data series:</p>

<ul>
<li><code>'bulk_modulus'</code> — the computed bulk modulus for each Voigt matrix C</li>
<li><code>'shear_modulus'</code> — the computed shear modulus for each Voigt matrix C</li>
<li><code>'percent_anisotropy'</code> — for each Voigt matrix C, the total percentage of the
norm of the elastic tensor ||C|| that deviates from the norm of the "closest"
isotropic elasticity tensor</li>
<li><code>'percent_hexagonal'</code> — for each C, the percentage of ||C|| attributed to
hexagonally symmetric minerals</li>
<li><code>'percent_tetragonal'</code> — for each C, the percentage of ||C|| attributed to
tetragonally symmetric minerals</li>
<li><code>'percent_orthorhombic'</code> — for each C, the percentage of ||C|| attributed to
orthorhombically symmetric minerals</li>
<li><code>'percent_monoclinic'</code> — for each C, the percentage of ||C|| attributed to
monoclinically symmetric minerals</li>
<li><code>'percent_triclinic'</code> — for each C, the percentage of ||C|| attributed to
triclinically "symmetric" minerals (no mirror planes)</li>
<li><code>'hexagonal_axis'</code> — for each C, the axis of hexagonal symmetry for the "closest"
hexagonally symmetric approximation to C, a.k.a. the "transverse isotropy" axis</li>
</ul>

<div class="pdoc-alert pdoc-alert-note">

<p>Only 5 symmetry classes are relevant for elasticity decomposition,
compared to the usual 6 used to describe crystal families.
Crystals with cubic symmetry contribute to the isotropic elasticity tensor,
because the lattice spacing is identical in all orthogonal directions.
Note also that the trigonal crystal <em>system</em> is not a crystal family
(it belongs to the hexagonal family).</p>

</div>
</div>


                </section>
                <section id="bingham_average">
                            <input id="bingham_average-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">bingham_average</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">orientations</span>, </span><span class="param"><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;a&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="bingham_average-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#bingham_average"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="bingham_average-180"><a href="#bingham_average-180"><span class="linenos">180</span></a><span class="k">def</span> <span class="nf">bingham_average</span><span class="p">(</span><span class="n">orientations</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">):</span>
</span><span id="bingham_average-181"><a href="#bingham_average-181"><span class="linenos">181</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute Bingham average of orientation matrices.</span>
</span><span id="bingham_average-182"><a href="#bingham_average-182"><span class="linenos">182</span></a>
</span><span id="bingham_average-183"><a href="#bingham_average-183"><span class="linenos">183</span></a><span class="sd">    Returns the antipodally symmetric average orientation</span>
</span><span id="bingham_average-184"><a href="#bingham_average-184"><span class="linenos">184</span></a><span class="sd">    of the given crystallographic `axis`, or the a-axis by default.</span>
</span><span id="bingham_average-185"><a href="#bingham_average-185"><span class="linenos">185</span></a><span class="sd">    Valid axis specifiers are &quot;a&quot; for [100], &quot;b&quot; for [010] and &quot;c&quot; for [001].</span>
</span><span id="bingham_average-186"><a href="#bingham_average-186"><span class="linenos">186</span></a>
</span><span id="bingham_average-187"><a href="#bingham_average-187"><span class="linenos">187</span></a><span class="sd">    See also: [Watson (1966)](https://doi.org/10.1086%2F627211),</span>
</span><span id="bingham_average-188"><a href="#bingham_average-188"><span class="linenos">188</span></a><span class="sd">    [Mardia &amp; Jupp, “Directional Statistics”](https://doi.org/10.1002/9780470316979).</span>
</span><span id="bingham_average-189"><a href="#bingham_average-189"><span class="linenos">189</span></a>
</span><span id="bingham_average-190"><a href="#bingham_average-190"><span class="linenos">190</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="bingham_average-191"><a href="#bingham_average-191"><span class="linenos">191</span></a>    <span class="k">match</span> <span class="n">axis</span><span class="p">:</span>
</span><span id="bingham_average-192"><a href="#bingham_average-192"><span class="linenos">192</span></a>        <span class="k">case</span> <span class="s2">&quot;a&quot;</span><span class="p">:</span>
</span><span id="bingham_average-193"><a href="#bingham_average-193"><span class="linenos">193</span></a>            <span class="n">row</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="bingham_average-194"><a href="#bingham_average-194"><span class="linenos">194</span></a>        <span class="k">case</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span>
</span><span id="bingham_average-195"><a href="#bingham_average-195"><span class="linenos">195</span></a>            <span class="n">row</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="bingham_average-196"><a href="#bingham_average-196"><span class="linenos">196</span></a>        <span class="k">case</span> <span class="s2">&quot;c&quot;</span><span class="p">:</span>
</span><span id="bingham_average-197"><a href="#bingham_average-197"><span class="linenos">197</span></a>            <span class="n">row</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="bingham_average-198"><a href="#bingham_average-198"><span class="linenos">198</span></a>        <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
</span><span id="bingham_average-199"><a href="#bingham_average-199"><span class="linenos">199</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;axis must be &#39;a&#39;, &#39;b&#39;, or &#39;c&#39;, not </span><span class="si">{</span><span class="n">axis</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="bingham_average-200"><a href="#bingham_average-200"><span class="linenos">200</span></a>
</span><span id="bingham_average-201"><a href="#bingham_average-201"><span class="linenos">201</span></a>    <span class="c1"># https://courses.eas.ualberta.ca/eas421/lecturepages/orientation.html</span>
</span><span id="bingham_average-202"><a href="#bingham_average-202"><span class="linenos">202</span></a>    <span class="c1"># Eigenvector corresponding to largest eigenvalue is the mean direction.</span>
</span><span id="bingham_average-203"><a href="#bingham_average-203"><span class="linenos">203</span></a>    <span class="c1"># SciPy returns eigenvalues in ascending order (same order for vectors).</span>
</span><span id="bingham_average-204"><a href="#bingham_average-204"><span class="linenos">204</span></a>    <span class="c1"># SciPy uses lower triangular entries by default, no need for all components.</span>
</span><span id="bingham_average-205"><a href="#bingham_average-205"><span class="linenos">205</span></a>    <span class="n">mean_vector</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">_stats</span><span class="o">.</span><span class="n">_scatter_matrix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">orientations</span><span class="p">),</span> <span class="n">row</span><span class="p">))[</span><span class="mi">1</span><span class="p">][</span>
</span><span id="bingham_average-206"><a href="#bingham_average-206"><span class="linenos">206</span></a>        <span class="p">:,</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="bingham_average-207"><a href="#bingham_average-207"><span class="linenos">207</span></a>    <span class="p">]</span>
</span><span id="bingham_average-208"><a href="#bingham_average-208"><span class="linenos">208</span></a>    <span class="k">return</span> <span class="n">mean_vector</span> <span class="o">/</span> <span class="n">la</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">mean_vector</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Compute Bingham average of orientation matrices.</p>

<p>Returns the antipodally symmetric average orientation
of the given crystallographic <code>axis</code>, or the a-axis by default.
Valid axis specifiers are "a" for [100], "b" for [010] and "c" for [001].</p>

<p>See also: <a href="https://doi.org/10.1086%2F627211">Watson (1966)</a>,
<a href="https://doi.org/10.1002/9780470316979">Mardia &amp; Jupp, “Directional Statistics”</a>.</p>
</div>


                </section>
                <section id="finite_strain">
                            <input id="finite_strain-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">finite_strain</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">deformation_gradient</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="finite_strain-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#finite_strain"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="finite_strain-211"><a href="#finite_strain-211"><span class="linenos">211</span></a><span class="k">def</span> <span class="nf">finite_strain</span><span class="p">(</span><span class="n">deformation_gradient</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="finite_strain-212"><a href="#finite_strain-212"><span class="linenos">212</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract measures of finite strain from the deformation gradient.</span>
</span><span id="finite_strain-213"><a href="#finite_strain-213"><span class="linenos">213</span></a>
</span><span id="finite_strain-214"><a href="#finite_strain-214"><span class="linenos">214</span></a><span class="sd">    Extracts the largest principal strain value and the vector defining the axis of</span>
</span><span id="finite_strain-215"><a href="#finite_strain-215"><span class="linenos">215</span></a><span class="sd">    maximum extension (longest semiaxis of the finite strain ellipsoid) from the 3x3</span>
</span><span id="finite_strain-216"><a href="#finite_strain-216"><span class="linenos">216</span></a><span class="sd">    deformation gradient tensor.</span>
</span><span id="finite_strain-217"><a href="#finite_strain-217"><span class="linenos">217</span></a>
</span><span id="finite_strain-218"><a href="#finite_strain-218"><span class="linenos">218</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="finite_strain-219"><a href="#finite_strain-219"><span class="linenos">219</span></a>    <span class="c1"># Get eigenvalues and eigenvectors of the left stretch (Cauchy-Green) tensor.</span>
</span><span id="finite_strain-220"><a href="#finite_strain-220"><span class="linenos">220</span></a>    <span class="n">B_λ</span><span class="p">,</span> <span class="n">B_v</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span>
</span><span id="finite_strain-221"><a href="#finite_strain-221"><span class="linenos">221</span></a>        <span class="n">deformation_gradient</span> <span class="o">@</span> <span class="n">deformation_gradient</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span>
</span><span id="finite_strain-222"><a href="#finite_strain-222"><span class="linenos">222</span></a>        <span class="n">driver</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;driver&quot;</span><span class="p">,</span> <span class="s2">&quot;ev&quot;</span><span class="p">),</span>
</span><span id="finite_strain-223"><a href="#finite_strain-223"><span class="linenos">223</span></a>    <span class="p">)</span>
</span><span id="finite_strain-224"><a href="#finite_strain-224"><span class="linenos">224</span></a>    <span class="c1"># Stretch ratio is sqrt(λ) - 1, the (-1) is so that undeformed strain is 0 not 1.</span>
</span><span id="finite_strain-225"><a href="#finite_strain-225"><span class="linenos">225</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">B_λ</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">B_v</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Extract measures of finite strain from the deformation gradient.</p>

<p>Extracts the largest principal strain value and the vector defining the axis of
maximum extension (longest semiaxis of the finite strain ellipsoid) from the 3x3
deformation gradient tensor.</p>
</div>


                </section>
                <section id="symmetry">
                            <input id="symmetry-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">symmetry</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">orientations</span>, </span><span class="param"><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;a&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="symmetry-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#symmetry"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="symmetry-228"><a href="#symmetry-228"><span class="linenos">228</span></a><span class="k">def</span> <span class="nf">symmetry</span><span class="p">(</span><span class="n">orientations</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">):</span>
</span><span id="symmetry-229"><a href="#symmetry-229"><span class="linenos">229</span></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Compute texture symmetry eigenvalue diagnostics from grain orientation matrices.</span>
</span><span id="symmetry-230"><a href="#symmetry-230"><span class="linenos">230</span></a>
</span><span id="symmetry-231"><a href="#symmetry-231"><span class="linenos">231</span></a><span class="sd">    Compute Point, Girdle and Random symmetry diagnostics</span>
</span><span id="symmetry-232"><a href="#symmetry-232"><span class="linenos">232</span></a><span class="sd">    for ternary texture classification.</span>
</span><span id="symmetry-233"><a href="#symmetry-233"><span class="linenos">233</span></a><span class="sd">    Returns the tuple (P, G, R) where</span>
</span><span id="symmetry-234"><a href="#symmetry-234"><span class="linenos">234</span></a><span class="sd">    $$</span>
</span><span id="symmetry-235"><a href="#symmetry-235"><span class="linenos">235</span></a><span class="sd">    \begin{align\*}</span>
</span><span id="symmetry-236"><a href="#symmetry-236"><span class="linenos">236</span></a><span class="sd">    P &amp;= (λ_{1} - λ_{2}) / N \cr</span>
</span><span id="symmetry-237"><a href="#symmetry-237"><span class="linenos">237</span></a><span class="sd">    G &amp;= 2 (λ_{2} - λ_{3}) / N \cr</span>
</span><span id="symmetry-238"><a href="#symmetry-238"><span class="linenos">238</span></a><span class="sd">    R &amp;= 3 λ_{3} / N</span>
</span><span id="symmetry-239"><a href="#symmetry-239"><span class="linenos">239</span></a><span class="sd">    \end{align\*}</span>
</span><span id="symmetry-240"><a href="#symmetry-240"><span class="linenos">240</span></a><span class="sd">    $$</span>
</span><span id="symmetry-241"><a href="#symmetry-241"><span class="linenos">241</span></a><span class="sd">    with $N$ the sum of the eigenvalues $λ_{1} ≥ λ_{2} ≥ λ_{3}$</span>
</span><span id="symmetry-242"><a href="#symmetry-242"><span class="linenos">242</span></a><span class="sd">    of the scatter (inertia) matrix.</span>
</span><span id="symmetry-243"><a href="#symmetry-243"><span class="linenos">243</span></a>
</span><span id="symmetry-244"><a href="#symmetry-244"><span class="linenos">244</span></a><span class="sd">    See e.g. [Vollmer (1990)](https://doi.org/10.1130/0016-7606(1990)102%3C0786:AAOEMT%3E2.3.CO;2).</span>
</span><span id="symmetry-245"><a href="#symmetry-245"><span class="linenos">245</span></a>
</span><span id="symmetry-246"><a href="#symmetry-246"><span class="linenos">246</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="symmetry-247"><a href="#symmetry-247"><span class="linenos">247</span></a>    <span class="k">match</span> <span class="n">axis</span><span class="p">:</span>
</span><span id="symmetry-248"><a href="#symmetry-248"><span class="linenos">248</span></a>        <span class="k">case</span> <span class="s2">&quot;a&quot;</span><span class="p">:</span>
</span><span id="symmetry-249"><a href="#symmetry-249"><span class="linenos">249</span></a>            <span class="n">row</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="symmetry-250"><a href="#symmetry-250"><span class="linenos">250</span></a>        <span class="k">case</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span>
</span><span id="symmetry-251"><a href="#symmetry-251"><span class="linenos">251</span></a>            <span class="n">row</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="symmetry-252"><a href="#symmetry-252"><span class="linenos">252</span></a>        <span class="k">case</span> <span class="s2">&quot;c&quot;</span><span class="p">:</span>
</span><span id="symmetry-253"><a href="#symmetry-253"><span class="linenos">253</span></a>            <span class="n">row</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="symmetry-254"><a href="#symmetry-254"><span class="linenos">254</span></a>        <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
</span><span id="symmetry-255"><a href="#symmetry-255"><span class="linenos">255</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;axis must be &#39;a&#39;, &#39;b&#39;, or &#39;c&#39;, not </span><span class="si">{</span><span class="n">axis</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="symmetry-256"><a href="#symmetry-256"><span class="linenos">256</span></a>
</span><span id="symmetry-257"><a href="#symmetry-257"><span class="linenos">257</span></a>    <span class="n">scatter</span> <span class="o">=</span> <span class="n">_stats</span><span class="o">.</span><span class="n">_scatter_matrix</span><span class="p">(</span><span class="n">orientations</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>
</span><span id="symmetry-258"><a href="#symmetry-258"><span class="linenos">258</span></a>    <span class="c1"># SciPy uses lower triangular entries by default, no need for all components.</span>
</span><span id="symmetry-259"><a href="#symmetry-259"><span class="linenos">259</span></a>    <span class="n">eigvals_descending</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">eigvalsh</span><span class="p">(</span><span class="n">scatter</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="symmetry-260"><a href="#symmetry-260"><span class="linenos">260</span></a>    <span class="n">sum_eigvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">eigvals_descending</span><span class="p">)</span>
</span><span id="symmetry-261"><a href="#symmetry-261"><span class="linenos">261</span></a>    <span class="k">return</span> <span class="p">(</span>
</span><span id="symmetry-262"><a href="#symmetry-262"><span class="linenos">262</span></a>        <span class="p">(</span><span class="n">eigvals_descending</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">eigvals_descending</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">sum_eigvals</span><span class="p">,</span>
</span><span id="symmetry-263"><a href="#symmetry-263"><span class="linenos">263</span></a>        <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">eigvals_descending</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">eigvals_descending</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="n">sum_eigvals</span><span class="p">,</span>
</span><span id="symmetry-264"><a href="#symmetry-264"><span class="linenos">264</span></a>        <span class="mi">3</span> <span class="o">*</span> <span class="n">eigvals_descending</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">sum_eigvals</span><span class="p">,</span>
</span><span id="symmetry-265"><a href="#symmetry-265"><span class="linenos">265</span></a>    <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Compute texture symmetry eigenvalue diagnostics from grain orientation matrices.</p>

<p>Compute Point, Girdle and Random symmetry diagnostics
for ternary texture classification.
Returns the tuple (P, G, R) where
$$
\begin{align*}
P &amp;= (λ_{1} - λ_{2}) / N \cr
G &amp;= 2 (λ_{2} - λ_{3}) / N \cr
R &amp;= 3 λ_{3} / N
\end{align*}
$$
with $N$ the sum of the eigenvalues $λ_{1} ≥ λ_{2} ≥ λ_{3}$
of the scatter (inertia) matrix.</p>

<p>See e.g. <a href="https://doi.org/10.1130/0016-7606(1990)102%3C0786:AAOEMT%3E2.3.CO;2">Vollmer (1990)</a>.</p>
</div>


                </section>
                <section id="misorientation_indices">
                            <input id="misorientation_indices-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">misorientation_indices</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">orientation_stack</span>,</span><span class="param">	<span class="n">system</span><span class="p">:</span> <span class="n"><a href="geometry.html#LatticeSystem">pydrex.geometry.LatticeSystem</a></span>,</span><span class="param">	<span class="n">bins</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">ncpus</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">pool</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="misorientation_indices-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#misorientation_indices"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="misorientation_indices-268"><a href="#misorientation_indices-268"><span class="linenos">268</span></a><span class="k">def</span> <span class="nf">misorientation_indices</span><span class="p">(</span>
</span><span id="misorientation_indices-269"><a href="#misorientation_indices-269"><span class="linenos">269</span></a>    <span class="n">orientation_stack</span><span class="p">,</span> <span class="n">system</span><span class="p">:</span> <span class="n">_geo</span><span class="o">.</span><span class="n">LatticeSystem</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ncpus</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pool</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="misorientation_indices-270"><a href="#misorientation_indices-270"><span class="linenos">270</span></a><span class="p">):</span>
</span><span id="misorientation_indices-271"><a href="#misorientation_indices-271"><span class="linenos">271</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate M-indices for a series of polycrystal textures.</span>
</span><span id="misorientation_indices-272"><a href="#misorientation_indices-272"><span class="linenos">272</span></a>
</span><span id="misorientation_indices-273"><a href="#misorientation_indices-273"><span class="linenos">273</span></a><span class="sd">    Calculate M-index using `misorientation_index` for a series of texture snapshots.</span>
</span><span id="misorientation_indices-274"><a href="#misorientation_indices-274"><span class="linenos">274</span></a><span class="sd">    The `orientation_stack` is a NxMx3x3 array of orientations where N is the number of</span>
</span><span id="misorientation_indices-275"><a href="#misorientation_indices-275"><span class="linenos">275</span></a><span class="sd">    texture snapshots and M is the number of grains.</span>
</span><span id="misorientation_indices-276"><a href="#misorientation_indices-276"><span class="linenos">276</span></a>
</span><span id="misorientation_indices-277"><a href="#misorientation_indices-277"><span class="linenos">277</span></a><span class="sd">    Uses the multiprocessing library to calculate texture indices for multiple snapshots</span>
</span><span id="misorientation_indices-278"><a href="#misorientation_indices-278"><span class="linenos">278</span></a><span class="sd">    simultaneously. If `ncpus` is `None` the number of CPU cores to use is chosen</span>
</span><span id="misorientation_indices-279"><a href="#misorientation_indices-279"><span class="linenos">279</span></a><span class="sd">    automatically based on the maximum number available to the Python interpreter,</span>
</span><span id="misorientation_indices-280"><a href="#misorientation_indices-280"><span class="linenos">280</span></a><span class="sd">    otherwise the specified number of cores is requested. Alternatively, an existing</span>
</span><span id="misorientation_indices-281"><a href="#misorientation_indices-281"><span class="linenos">281</span></a><span class="sd">    instance of `multiprocessing.Pool` can be provided.</span>
</span><span id="misorientation_indices-282"><a href="#misorientation_indices-282"><span class="linenos">282</span></a>
</span><span id="misorientation_indices-283"><a href="#misorientation_indices-283"><span class="linenos">283</span></a><span class="sd">    See `misorientation_index` for documentation of the remaining arguments.</span>
</span><span id="misorientation_indices-284"><a href="#misorientation_indices-284"><span class="linenos">284</span></a>
</span><span id="misorientation_indices-285"><a href="#misorientation_indices-285"><span class="linenos">285</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="misorientation_indices-286"><a href="#misorientation_indices-286"><span class="linenos">286</span></a>    <span class="k">if</span> <span class="n">ncpus</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">pool</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="misorientation_indices-287"><a href="#misorientation_indices-287"><span class="linenos">287</span></a>        <span class="n">_log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;ignoring `ncpus` argument because a Pool was provided&quot;</span><span class="p">)</span>
</span><span id="misorientation_indices-288"><a href="#misorientation_indices-288"><span class="linenos">288</span></a>    <span class="n">m_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">orientation_stack</span><span class="p">))</span>
</span><span id="misorientation_indices-289"><a href="#misorientation_indices-289"><span class="linenos">289</span></a>    <span class="n">_run</span> <span class="o">=</span> <span class="n">ft</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span>
</span><span id="misorientation_indices-290"><a href="#misorientation_indices-290"><span class="linenos">290</span></a>        <span class="n">misorientation_index</span><span class="p">,</span>
</span><span id="misorientation_indices-291"><a href="#misorientation_indices-291"><span class="linenos">291</span></a>        <span class="n">system</span><span class="o">=</span><span class="n">system</span><span class="p">,</span>
</span><span id="misorientation_indices-292"><a href="#misorientation_indices-292"><span class="linenos">292</span></a>        <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span>
</span><span id="misorientation_indices-293"><a href="#misorientation_indices-293"><span class="linenos">293</span></a>    <span class="p">)</span>
</span><span id="misorientation_indices-294"><a href="#misorientation_indices-294"><span class="linenos">294</span></a>    <span class="k">if</span> <span class="n">pool</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="misorientation_indices-295"><a href="#misorientation_indices-295"><span class="linenos">295</span></a>        <span class="k">if</span> <span class="n">ncpus</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="misorientation_indices-296"><a href="#misorientation_indices-296"><span class="linenos">296</span></a>            <span class="n">ncpus</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sched_getaffinity</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="misorientation_indices-297"><a href="#misorientation_indices-297"><span class="linenos">297</span></a>        <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="n">ncpus</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
</span><span id="misorientation_indices-298"><a href="#misorientation_indices-298"><span class="linenos">298</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">out</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pool</span><span class="o">.</span><span class="n">imap</span><span class="p">(</span><span class="n">_run</span><span class="p">,</span> <span class="n">orientation_stack</span><span class="p">)):</span>
</span><span id="misorientation_indices-299"><a href="#misorientation_indices-299"><span class="linenos">299</span></a>                <span class="n">m_indices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span>
</span><span id="misorientation_indices-300"><a href="#misorientation_indices-300"><span class="linenos">300</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="misorientation_indices-301"><a href="#misorientation_indices-301"><span class="linenos">301</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">out</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pool</span><span class="o">.</span><span class="n">imap</span><span class="p">(</span><span class="n">_run</span><span class="p">,</span> <span class="n">orientation_stack</span><span class="p">)):</span>
</span><span id="misorientation_indices-302"><a href="#misorientation_indices-302"><span class="linenos">302</span></a>            <span class="n">m_indices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span>
</span><span id="misorientation_indices-303"><a href="#misorientation_indices-303"><span class="linenos">303</span></a>    <span class="k">return</span> <span class="n">m_indices</span>
</span></pre></div>


            <div class="docstring"><p>Calculate M-indices for a series of polycrystal textures.</p>

<p>Calculate M-index using <code><a href="#misorientation_index">misorientation_index</a></code> for a series of texture snapshots.
The <code>orientation_stack</code> is a NxMx3x3 array of orientations where N is the number of
texture snapshots and M is the number of grains.</p>

<p>Uses the multiprocessing library to calculate texture indices for multiple snapshots
simultaneously. If <code>ncpus</code> is <code>None</code> the number of CPU cores to use is chosen
automatically based on the maximum number available to the Python interpreter,
otherwise the specified number of cores is requested. Alternatively, an existing
instance of <code>multiprocessing.Pool</code> can be provided.</p>

<p>See <code><a href="#misorientation_index">misorientation_index</a></code> for documentation of the remaining arguments.</p>
</div>


                </section>
                <section id="misorientation_index">
                            <input id="misorientation_index-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">misorientation_index</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">orientations</span>, </span><span class="param"><span class="n">system</span><span class="p">:</span> <span class="n"><a href="geometry.html#LatticeSystem">pydrex.geometry.LatticeSystem</a></span>, </span><span class="param"><span class="n">bins</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="misorientation_index-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#misorientation_index"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="misorientation_index-306"><a href="#misorientation_index-306"><span class="linenos">306</span></a><span class="k">def</span> <span class="nf">misorientation_index</span><span class="p">(</span><span class="n">orientations</span><span class="p">,</span> <span class="n">system</span><span class="p">:</span> <span class="n">_geo</span><span class="o">.</span><span class="n">LatticeSystem</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="misorientation_index-307"><a href="#misorientation_index-307"><span class="linenos">307</span></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate M-index for polycrystal orientations.</span>
</span><span id="misorientation_index-308"><a href="#misorientation_index-308"><span class="linenos">308</span></a>
</span><span id="misorientation_index-309"><a href="#misorientation_index-309"><span class="linenos">309</span></a><span class="sd">    The `bins` argument is passed to `numpy.histogram`.</span>
</span><span id="misorientation_index-310"><a href="#misorientation_index-310"><span class="linenos">310</span></a><span class="sd">    If left as `None`, 1° bins will be used as recommended by the reference paper.</span>
</span><span id="misorientation_index-311"><a href="#misorientation_index-311"><span class="linenos">311</span></a><span class="sd">    The `symmetry` argument specifies the lattice system which determines intrinsic</span>
</span><span id="misorientation_index-312"><a href="#misorientation_index-312"><span class="linenos">312</span></a><span class="sd">    symmetry degeneracies and the maximum allowable misorientation angle.</span>
</span><span id="misorientation_index-313"><a href="#misorientation_index-313"><span class="linenos">313</span></a><span class="sd">    See `_geo.LatticeSystem` for supported systems.</span>
</span><span id="misorientation_index-314"><a href="#misorientation_index-314"><span class="linenos">314</span></a>
</span><span id="misorientation_index-315"><a href="#misorientation_index-315"><span class="linenos">315</span></a><span class="sd">    .. warning::</span>
</span><span id="misorientation_index-316"><a href="#misorientation_index-316"><span class="linenos">316</span></a><span class="sd">        This method must be able to allocate an array of shape </span>
</span><span id="misorientation_index-317"><a href="#misorientation_index-317"><span class="linenos">317</span></a><span class="sd">        $ \frac{N!}{2(N-2)!}× M^{2} $</span>
</span><span id="misorientation_index-318"><a href="#misorientation_index-318"><span class="linenos">318</span></a><span class="sd">        for N the length of `orientations` and M the number of symmetry operations for</span>
</span><span id="misorientation_index-319"><a href="#misorientation_index-319"><span class="linenos">319</span></a><span class="sd">        the given `system`.</span>
</span><span id="misorientation_index-320"><a href="#misorientation_index-320"><span class="linenos">320</span></a>
</span><span id="misorientation_index-321"><a href="#misorientation_index-321"><span class="linenos">321</span></a><span class="sd">    See [Skemer et al. (2005)](https://doi.org/10.1016/j.tecto.2005.08.023).</span>
</span><span id="misorientation_index-322"><a href="#misorientation_index-322"><span class="linenos">322</span></a>
</span><span id="misorientation_index-323"><a href="#misorientation_index-323"><span class="linenos">323</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="misorientation_index-324"><a href="#misorientation_index-324"><span class="linenos">324</span></a>    <span class="n">θmax</span> <span class="o">=</span> <span class="n">_stats</span><span class="o">.</span><span class="n">_max_misorientation</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>
</span><span id="misorientation_index-325"><a href="#misorientation_index-325"><span class="linenos">325</span></a>    <span class="n">misorientations_count</span><span class="p">,</span> <span class="n">bin_edges</span> <span class="o">=</span> <span class="n">_stats</span><span class="o">.</span><span class="n">misorientation_hist</span><span class="p">(</span>
</span><span id="misorientation_index-326"><a href="#misorientation_index-326"><span class="linenos">326</span></a>        <span class="n">orientations</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="n">bins</span>
</span><span id="misorientation_index-327"><a href="#misorientation_index-327"><span class="linenos">327</span></a>    <span class="p">)</span>
</span><span id="misorientation_index-328"><a href="#misorientation_index-328"><span class="linenos">328</span></a>    <span class="c1"># Compute counts of theoretical misorientation for an isotropic aggregate,</span>
</span><span id="misorientation_index-329"><a href="#misorientation_index-329"><span class="linenos">329</span></a>    <span class="c1"># using the same bins (Skemer 2005 recommend 1° bins).</span>
</span><span id="misorientation_index-330"><a href="#misorientation_index-330"><span class="linenos">330</span></a>    <span class="n">misorientations_theory</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="misorientation_index-331"><a href="#misorientation_index-331"><span class="linenos">331</span></a>        <span class="p">[</span>
</span><span id="misorientation_index-332"><a href="#misorientation_index-332"><span class="linenos">332</span></a>            <span class="n">_stats</span><span class="o">.</span><span class="n">misorientations_random</span><span class="p">(</span><span class="n">bin_edges</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">bin_edges</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">system</span><span class="p">)</span>
</span><span id="misorientation_index-333"><a href="#misorientation_index-333"><span class="linenos">333</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">misorientations_count</span><span class="p">))</span>
</span><span id="misorientation_index-334"><a href="#misorientation_index-334"><span class="linenos">334</span></a>        <span class="p">]</span>
</span><span id="misorientation_index-335"><a href="#misorientation_index-335"><span class="linenos">335</span></a>    <span class="p">)</span>
</span><span id="misorientation_index-336"><a href="#misorientation_index-336"><span class="linenos">336</span></a>    <span class="c1"># Equation 2 in Skemer 2005.</span>
</span><span id="misorientation_index-337"><a href="#misorientation_index-337"><span class="linenos">337</span></a>    <span class="k">return</span> <span class="p">(</span><span class="n">θmax</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">misorientations_count</span><span class="p">)))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
</span><span id="misorientation_index-338"><a href="#misorientation_index-338"><span class="linenos">338</span></a>        <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">misorientations_theory</span> <span class="o">-</span> <span class="n">misorientations_count</span><span class="p">)</span>
</span><span id="misorientation_index-339"><a href="#misorientation_index-339"><span class="linenos">339</span></a>    <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Calculate M-index for polycrystal orientations.</p>

<p>The <code>bins</code> argument is passed to <code>numpy.histogram</code>.
If left as <code>None</code>, 1° bins will be used as recommended by the reference paper.
The <code><a href="#symmetry">symmetry</a></code> argument specifies the lattice system which determines intrinsic
symmetry degeneracies and the maximum allowable misorientation angle.
See <code>_geo.LatticeSystem</code> for supported systems.</p>

<div class="pdoc-alert pdoc-alert-warning">

<p>This method must be able to allocate an array of shape 
$ \frac{N!}{2(N-2)!}× M^{2} $
for N the length of <code>orientations</code> and M the number of symmetry operations for
the given <code>system</code>.</p>

</div>

<p>See <a href="https://doi.org/10.1016/j.tecto.2005.08.023">Skemer et al. (2005)</a>.</p>
</div>


                </section>
                <section id="coaxial_index">
                            <input id="coaxial_index-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">coaxial_index</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">orientations</span>, </span><span class="param"><span class="n">axis1</span><span class="o">=</span><span class="s1">&#39;b&#39;</span>, </span><span class="param"><span class="n">axis2</span><span class="o">=</span><span class="s1">&#39;a&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="coaxial_index-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#coaxial_index"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="coaxial_index-342"><a href="#coaxial_index-342"><span class="linenos">342</span></a><span class="k">def</span> <span class="nf">coaxial_index</span><span class="p">(</span><span class="n">orientations</span><span class="p">,</span> <span class="n">axis1</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">axis2</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">):</span>
</span><span id="coaxial_index-343"><a href="#coaxial_index-343"><span class="linenos">343</span></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate coaxial “BA” index for a combination of two crystal axes.</span>
</span><span id="coaxial_index-344"><a href="#coaxial_index-344"><span class="linenos">344</span></a>
</span><span id="coaxial_index-345"><a href="#coaxial_index-345"><span class="linenos">345</span></a><span class="sd">    The BA index of [Mainprice et al. (2015)](https://doi.org/10.1144/SP409.8)</span>
</span><span id="coaxial_index-346"><a href="#coaxial_index-346"><span class="linenos">346</span></a><span class="sd">    is derived from the eigenvalue `symmetry` diagnostics and measures point vs girdle</span>
</span><span id="coaxial_index-347"><a href="#coaxial_index-347"><span class="linenos">347</span></a><span class="sd">    symmetry in the aggregate. $BA ∈ [0, 1]$ where $BA = 0$ corresponds to a perfect</span>
</span><span id="coaxial_index-348"><a href="#coaxial_index-348"><span class="linenos">348</span></a><span class="sd">    axial girdle texture and $BA = 1$ represents a point symmetry texture assuming that</span>
</span><span id="coaxial_index-349"><a href="#coaxial_index-349"><span class="linenos">349</span></a><span class="sd">    the random component $R$ is negligible. May be less susceptible to random</span>
</span><span id="coaxial_index-350"><a href="#coaxial_index-350"><span class="linenos">350</span></a><span class="sd">    fluctuations compared to the raw eigenvalue diagnostics.</span>
</span><span id="coaxial_index-351"><a href="#coaxial_index-351"><span class="linenos">351</span></a>
</span><span id="coaxial_index-352"><a href="#coaxial_index-352"><span class="linenos">352</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="coaxial_index-353"><a href="#coaxial_index-353"><span class="linenos">353</span></a>    <span class="n">P1</span><span class="p">,</span> <span class="n">G1</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">symmetry</span><span class="p">(</span><span class="n">orientations</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis1</span><span class="p">)</span>
</span><span id="coaxial_index-354"><a href="#coaxial_index-354"><span class="linenos">354</span></a>    <span class="n">P2</span><span class="p">,</span> <span class="n">G2</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">symmetry</span><span class="p">(</span><span class="n">orientations</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis2</span><span class="p">)</span>
</span><span id="coaxial_index-355"><a href="#coaxial_index-355"><span class="linenos">355</span></a>    <span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">P1</span> <span class="o">/</span> <span class="p">(</span><span class="n">G1</span> <span class="o">+</span> <span class="n">P1</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span><span class="n">G2</span> <span class="o">/</span> <span class="p">(</span><span class="n">G2</span> <span class="o">+</span> <span class="n">P2</span><span class="p">)))</span>
</span></pre></div>


            <div class="docstring"><p>Calculate coaxial “BA” index for a combination of two crystal axes.</p>

<p>The BA index of <a href="https://doi.org/10.1144/SP409.8">Mainprice et al. (2015)</a>
is derived from the eigenvalue <code><a href="#symmetry">symmetry</a></code> diagnostics and measures point vs girdle
symmetry in the aggregate. $BA ∈ [0, 1]$ where $BA = 0$ corresponds to a perfect
axial girdle texture and $BA = 1$ represents a point symmetry texture assuming that
the random component $R$ is negligible. May be less susceptible to random
fluctuations compared to the raw eigenvalue diagnostics.</p>
</div>


                </section>
                <section id="smallest_angle">
                            <input id="smallest_angle-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">smallest_angle</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">vector</span>, </span><span class="param"><span class="n">axis</span>, </span><span class="param"><span class="n">plane</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="smallest_angle-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#smallest_angle"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="smallest_angle-358"><a href="#smallest_angle-358"><span class="linenos">358</span></a><span class="k">def</span> <span class="nf">smallest_angle</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">plane</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="smallest_angle-359"><a href="#smallest_angle-359"><span class="linenos">359</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get smallest angle between a unit `vector` and a bidirectional `axis`.</span>
</span><span id="smallest_angle-360"><a href="#smallest_angle-360"><span class="linenos">360</span></a>
</span><span id="smallest_angle-361"><a href="#smallest_angle-361"><span class="linenos">361</span></a><span class="sd">    The axis is specified using either of its two parallel unit vectors.</span>
</span><span id="smallest_angle-362"><a href="#smallest_angle-362"><span class="linenos">362</span></a><span class="sd">    Optionally project the vector onto the `plane` (given by its unit normal)</span>
</span><span id="smallest_angle-363"><a href="#smallest_angle-363"><span class="linenos">363</span></a><span class="sd">    before calculating the angle.</span>
</span><span id="smallest_angle-364"><a href="#smallest_angle-364"><span class="linenos">364</span></a>
</span><span id="smallest_angle-365"><a href="#smallest_angle-365"><span class="linenos">365</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="smallest_angle-366"><a href="#smallest_angle-366"><span class="linenos">366</span></a>    <span class="k">if</span> <span class="n">plane</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="smallest_angle-367"><a href="#smallest_angle-367"><span class="linenos">367</span></a>        <span class="n">_plane</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">plane</span><span class="p">)</span>
</span><span id="smallest_angle-368"><a href="#smallest_angle-368"><span class="linenos">368</span></a>        <span class="n">_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span> <span class="o">-</span> <span class="n">_plane</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="n">_plane</span><span class="p">)</span>
</span><span id="smallest_angle-369"><a href="#smallest_angle-369"><span class="linenos">369</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="smallest_angle-370"><a href="#smallest_angle-370"><span class="linenos">370</span></a>        <span class="n">_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span>
</span><span id="smallest_angle-371"><a href="#smallest_angle-371"><span class="linenos">371</span></a>    <span class="n">angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span>
</span><span id="smallest_angle-372"><a href="#smallest_angle-372"><span class="linenos">372</span></a>        <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span>
</span><span id="smallest_angle-373"><a href="#smallest_angle-373"><span class="linenos">373</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">_vector</span><span class="p">,</span> <span class="n">axis</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">la</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">_vector</span><span class="p">)</span> <span class="o">*</span> <span class="n">la</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">axis</span><span class="p">)),</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="smallest_angle-374"><a href="#smallest_angle-374"><span class="linenos">374</span></a>        <span class="p">)</span>
</span><span id="smallest_angle-375"><a href="#smallest_angle-375"><span class="linenos">375</span></a>    <span class="p">)</span>
</span><span id="smallest_angle-376"><a href="#smallest_angle-376"><span class="linenos">376</span></a>    <span class="k">if</span> <span class="n">angle</span> <span class="o">&gt;</span> <span class="mi">90</span><span class="p">:</span>
</span><span id="smallest_angle-377"><a href="#smallest_angle-377"><span class="linenos">377</span></a>        <span class="k">return</span> <span class="mi">180</span> <span class="o">-</span> <span class="n">angle</span>
</span><span id="smallest_angle-378"><a href="#smallest_angle-378"><span class="linenos">378</span></a>    <span class="k">return</span> <span class="n">angle</span>
</span></pre></div>


            <div class="docstring"><p>Get smallest angle between a unit <code>vector</code> and a bidirectional <code>axis</code>.</p>

<p>The axis is specified using either of its two parallel unit vectors.
Optionally project the vector onto the <code>plane</code> (given by its unit normal)
before calculating the angle.</p>
</div>


                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>